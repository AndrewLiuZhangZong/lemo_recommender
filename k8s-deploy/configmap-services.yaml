# ConfigMap - 统一服务配置
# 所有微服务共享的配置
apiVersion: v1
kind: ConfigMap
metadata:
  name: lemo-services-config
  namespace: lemo-dev
data:
  # ========== 数据库配置 ==========
  MONGODB_HOST: "mongodb-service.lemo-dev.svc.cluster.local"
  MONGODB_PORT: "27017"
  MONGODB_DATABASE: "lemo_recommender"
  MONGODB_USER: "lemo"
  # MONGODB_PASSWORD 应该使用Secret
  
  # ClickHouse配置
  CLICKHOUSE_HOST: "clickhouse-service.lemo-dev.svc.cluster.local"
  CLICKHOUSE_PORT: "8123"
  CLICKHOUSE_DATABASE: "lemo_recommender"
  CLICKHOUSE_USER: "default"
  
  # Redis配置
  REDIS_HOST: "redis-service.lemo-dev.svc.cluster.local"
  REDIS_PORT: "6379"
  REDIS_DB: "0"
  
  # Milvus配置
  MILVUS_HOST: "milvus-service.lemo-dev.svc.cluster.local"
  MILVUS_PORT: "19530"
  
  # ========== Kafka配置 ==========
  KAFKA_BOOTSTRAP_SERVERS: "kafka-service.lemo-dev.svc.cluster.local:9092"
  KAFKA_TOPIC_BEHAVIORS: "user_behaviors"
  
  # ========== 服务发现配置 ==========
  SERVICE_DISCOVERY_MODE: "istio"  # istio | k8s | local
  ISTIO_ENABLED: "true"
  K8S_NAMESPACE: "lemo-dev"
  
  # ========== gRPC服务端口（仅用于本地开发） ==========
  # 在Istio模式下，使用服务名即可，端口由ServicePort类管理
  GRPC_HOST: "0.0.0.0"
  
  # ========== 日志配置 ==========
  LOG_LEVEL: "INFO"
  
  # ========== 性能配置 ==========
  GRPC_MAX_WORKERS: "10"
  GRPC_MAX_MESSAGE_SIZE: "52428800"  # 50MB

---
# Secret - 敏感配置（密码、密钥）
apiVersion: v1
kind: Secret
metadata:
  name: lemo-services-secret
  namespace: lemo-dev
type: Opaque
stringData:
  # MongoDB密码
  MONGODB_PASSWORD: "lemo_password_change_in_production"
  
  # ClickHouse密码
  CLICKHOUSE_PASSWORD: ""
  
  # Redis密码
  REDIS_PASSWORD: ""
  
  # JWT密钥（如果需要）
  JWT_SECRET: "your-jwt-secret-key-change-in-production"

---
# ConfigMap - 召回服务配置
apiVersion: v1
kind: ConfigMap
metadata:
  name: recall-service-config
  namespace: lemo-dev
data:
  GRPC_PORT: "8081"
  SERVICE_NAME: "recall-service"
  # 召回特定配置
  DEFAULT_RECALL_LIMIT: "500"
  ALS_MODEL_PATH: "/models/als"

---
# ConfigMap - 精排服务配置
apiVersion: v1
kind: ConfigMap
metadata:
  name: ranking-service-config
  namespace: lemo-dev
data:
  GRPC_PORT: "8082"
  SERVICE_NAME: "ranking-service"
  # 精排特定配置
  DEFAULT_RANKER: "deepfm"
  MODEL_PATH: "/models/deepfm"
  ONNX_RUNTIME_THREADS: "4"

---
# ConfigMap - 重排服务配置
apiVersion: v1
kind: ConfigMap
metadata:
  name: reranking-service-config
  namespace: lemo-dev
data:
  GRPC_PORT: "8083"
  SERVICE_NAME: "reranking-service"
  # 重排特定配置
  DIVERSITY_WINDOW: "10"
  FRESHNESS_WEIGHT: "0.3"

---
# ConfigMap - 用户服务配置
apiVersion: v1
kind: ConfigMap
metadata:
  name: user-service-config
  namespace: lemo-dev
data:
  GRPC_PORT: "8084"
  SERVICE_NAME: "user-service"
  # 用户服务特定配置
  CACHE_TTL: "3600"  # 用户画像缓存1小时
  BATCH_SIZE: "100"

---
# ConfigMap - 物品服务配置
apiVersion: v1
kind: ConfigMap
metadata:
  name: item-service-config
  namespace: lemo-dev
data:
  GRPC_PORT: "8085"
  SERVICE_NAME: "item-service"
  # 物品服务特定配置
  ENABLE_VECTOR_STORAGE: "true"
  MILVUS_COLLECTION: "item_embeddings"

---
# ConfigMap - 行为服务配置
apiVersion: v1
kind: ConfigMap
metadata:
  name: behavior-service-config
  namespace: lemo-dev
data:
  GRPC_PORT: "8086"
  SERVICE_NAME: "behavior-service"
  # 行为服务特定配置
  KAFKA_BATCH_SIZE: "100"
  KAFKA_LINGER_MS: "10"
  KAFKA_COMPRESSION_TYPE: "gzip"

