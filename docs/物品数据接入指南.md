# ç‰©å“æ•°æ®æ¥å…¥æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•å°†ä¸šåŠ¡ç³»ç»Ÿçš„ç‰©å“æ•°æ®æ¥å…¥æ¨èç³»ç»Ÿï¼ŒåŒ…æ‹¬ä¸åŒåœºæ™¯çš„æ•°æ®ç»“æ„è§„èŒƒã€æ¥å…¥æ–¹å¼ã€æ•°æ®æµå‘ã€ä»¥åŠæ¨¡å‹è®­ç»ƒå…¨æµç¨‹ã€‚

---

## ğŸ“– ç›®å½•

- [1. æ”¯æŒçš„æ¥å…¥æ–¹å¼](#-æ”¯æŒçš„æ¥å…¥æ–¹å¼)
- [2. ä¸åŒåœºæ™¯çš„ç‰©å“æ•°æ®ç»“æ„](#-ä¸åŒåœºæ™¯çš„ç‰©å“æ•°æ®ç»“æ„)
- [3. å®Œæ•´æ•°æ®æµå‘](#-å®Œæ•´æ•°æ®æµå‘)
- [4. APIæ¨é€æ¥å…¥](#æ–¹å¼1apiæ¨é€æ¨è)
- [5. Kafkaæ¶ˆè´¹æ¥å…¥](#æ–¹å¼2kafkaæ¶ˆè´¹)
- [6. æœ€ä½³å®è·µ](#-æœ€ä½³å®è·µ)
- [7. å¸¸è§é—®é¢˜](#-å¸¸è§é—®é¢˜)

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

ç‰©å“æ•°æ®åœ¨æ¨èç³»ç»Ÿä¸­çš„ä½ç½®å’Œæµè½¬ï¼š

```mermaid
graph LR
    subgraph ä¸šåŠ¡ç³»ç»Ÿ
        A1[å†…å®¹ç®¡ç†ç³»ç»Ÿ]
        A2[å•†å“ç®¡ç†ç³»ç»Ÿ]
        A3[è¯¾ç¨‹ç®¡ç†ç³»ç»Ÿ]
    end
    
    subgraph æ¨èç³»ç»Ÿ
        B1[ç‰©å“æ¥å…¥å±‚<br/>API/Kafka]
        B2[ç‰©å“å­˜å‚¨<br/>MongoDB]
        B3[å‘é‡å¼•æ“<br/>Milvus]
        B4[æ¨èå¼•æ“<br/>å¬å›/æ’åº]
        B5[æ¨¡å‹è®­ç»ƒ<br/>ç¦»çº¿/åœ¨çº¿]
    end
    
    subgraph å‰ç«¯åº”ç”¨
        C1[Web/App]
        C2[æ¨èFeed]
    end
    
    A1 & A2 & A3 -->|ç‰©å“æ•°æ®| B1
    B1 -->|å­˜å‚¨| B2
    B2 -->|å‘é‡åŒ–| B3
    B3 & B2 -->|å¬å›| B4
    B5 -.->|æ¨¡å‹| B4
    B4 -->|æ¨èç»“æœ| C2
    C1 -->|è¯·æ±‚æ¨è| B4
    C1 -->|è¡Œä¸ºåŸ‹ç‚¹| B5
    
    style B1 fill:#fff4e1
    style B2 fill:#e8f5e9
    style B3 fill:#e8f5e9
    style B4 fill:#e1f5ff
    style B5 fill:#f3e5f5
```

**æ ¸å¿ƒæµç¨‹**ï¼š
1. ğŸ“¥ **ç‰©å“æ¥å…¥**ï¼šä¸šåŠ¡ç³»ç»Ÿé€šè¿‡API/Kafkaå°†ç‰©å“æ•°æ®æ¨é€åˆ°æ¨èç³»ç»Ÿ
2. ğŸ’¾ **æ•°æ®å­˜å‚¨**ï¼šMongoDBå­˜å‚¨ç‰©å“å…ƒæ•°æ®ï¼ˆçµæ´»Schemaæ”¯æŒå¤šåœºæ™¯ï¼‰
3. ğŸ§¬ **å‘é‡ç”Ÿæˆ**ï¼šæå–æ–‡æœ¬ç‰¹å¾ï¼Œç”Ÿæˆå‘é‡è¡¨ç¤ºï¼Œå­˜å…¥Milvus
4. ğŸ¯ **æ¨èå¬å›**ï¼šåŸºäºå‘é‡ã€çƒ­åº¦ã€æ ‡ç­¾ç­‰å¤šè·¯å¬å›å€™é€‰ç‰©å“
5. ğŸ“Š **æ¨¡å‹è®­ç»ƒ**ï¼šä½¿ç”¨è¡Œä¸ºæ•°æ®è®­ç»ƒæ’åºæ¨¡å‹ï¼Œä¼˜åŒ–æ¨èæ•ˆæœ

---

## ğŸ¯ æ”¯æŒçš„æ¥å…¥æ–¹å¼

æ¨èç³»ç»Ÿæ”¯æŒ**ä¸¤ç§**æ•°æ®æ¥å…¥æ–¹å¼ï¼š

| æ–¹å¼ | é€‚ç”¨åœºæ™¯ | å®æ—¶æ€§ | å¤æ‚åº¦ |
|------|---------|--------|--------|
| **APIæ¨é€** | å°è§„æ¨¡ã€å®æ—¶å‘å¸ƒ | âš¡ï¸ ç§’çº§ | â­ ç®€å• |
| **Kafkaæ¶ˆè´¹** | å¤§è§„æ¨¡ã€é«˜åå | âš¡ï¸ ç§’çº§ | â­â­ ä¸­ç­‰ |

---

## ğŸ“¦ ä¸åŒåœºæ™¯çš„ç‰©å“æ•°æ®ç»“æ„

æ¨èç³»ç»Ÿæ”¯æŒå¤šåœºæ™¯æ¥å…¥ï¼Œæ¯ä¸ªåœºæ™¯çš„ç‰©å“å…ƒæ•°æ®ï¼ˆ`metadata`ï¼‰å­—æ®µä¸åŒã€‚ç³»ç»Ÿé‡‡ç”¨**çµæ´»Schema**è®¾è®¡ï¼Œ`metadata`ä¸ºJSONå¯¹è±¡ï¼Œå¯æ ¹æ®åœºæ™¯è‡ªå®šä¹‰å­—æ®µã€‚

### åœºæ™¯æ•°æ®ç»“æ„å¯¹æ¯”å›¾

```mermaid
graph TD
    Item[ç‰©å“æ•°æ®Item]
    
    Item --> Common[é€šç”¨å¿…å¡«å­—æ®µ]
    Item --> Scenario{åœºæ™¯ç‰¹å®šå­—æ®µ}
    
    Common --> C1[item_id]
    Common --> C2[title]
    Common --> C3[description]
    Common --> C4[category]
    Common --> C5[tags]
    Common --> C6[publish_time]
    
    Scenario -->|è§†é¢‘åœºæ™¯| Video[Video Scenario]
    Scenario -->|ç”µå•†åœºæ™¯| Ecom[Ecommerce Scenario]
    Scenario -->|æ–°é—»åœºæ™¯| News[News Scenario]
    Scenario -->|éŸ³ä¹åœºæ™¯| Music[Music Scenario]
    Scenario -->|æ•™è‚²åœºæ™¯| Edu[Education Scenario]
    Scenario -->|å†…å®¹åœºæ™¯| Content[Content Scenario]
    Scenario -->|ç¤¾äº¤åœºæ™¯| Social[Social Scenario]
    Scenario -->|ä¸ªæ€§åŒ–åœºæ™¯| Person[Personalized Scenario]
    
    Video --> V1[video_url]
    Video --> V2[duration]
    Video --> V3[author_id]
    Video --> V4[completion_rate]
    
    Ecom --> E1[price]
    Ecom --> E2[stock]
    Ecom --> E3[brand]
    Ecom --> E4[sales_count]
    
    News --> N1[content]
    News --> N2[summary]
    News --> N3[keywords]
    News --> N4[sentiment]
    
    Music --> M1[audio_url]
    Music --> M2[artist]
    Music --> M3[album]
    Music --> M4[genre/mood]
    
    Edu --> Ed1[instructor]
    Edu --> Ed2[difficulty]
    Edu --> Ed3[lesson_count]
    Edu --> Ed4[rating]
    
    Content --> Ct1[content_type]
    Content --> Ct2[word_count]
    Content --> Ct3[topic]
    Content --> Ct4[quality_score]
    
    Social --> So1[user_profile]
    Social --> So2[follower_count]
    Social --> So3[influence_score]
    Social --> So4[relationship_type]
    
    Person --> Pe1[personalization_score]
    Person --> Pe2[match_reasons]
    Person --> Pe3[recommendation_strategy]
    Person --> Pe4[diversity_group]
    
    style Common fill:#e1f5ff
    style Video fill:#fff4e1
    style Ecom fill:#e8f5e9
    style News fill:#f3e5f5
    style Music fill:#ffe1f5
    style Edu fill:#fff9e1
    style Content fill:#e1ffe8
    style Social fill:#ffe8e1
    style Person fill:#f5e1ff
```

**è®¾è®¡ç†å¿µ**ï¼š
- ğŸ”µ **é€šç”¨å­—æ®µ**ï¼šæ‰€æœ‰åœºæ™¯å…±äº«ï¼Œç”¨äºåŸºç¡€æ¨èï¼ˆå‘é‡ã€æ ‡ç­¾ã€åˆ†ç±»ï¼‰
- ğŸŸ¡ **è§†é¢‘å­—æ®µ**ï¼šæ’­æ”¾æ—¶é•¿ã€ä½œè€…ã€å®Œæ’­ç‡ç­‰è§†é¢‘ç‰¹æœ‰æŒ‡æ ‡
- ğŸŸ¢ **ç”µå•†å­—æ®µ**ï¼šä»·æ ¼ã€åº“å­˜ã€å“ç‰Œç­‰å•†å“ç‰¹æœ‰å±æ€§
- ğŸŸ£ **æ–°é—»å­—æ®µ**ï¼šæ­£æ–‡ã€å…³é”®è¯ã€æƒ…æ„Ÿç­‰å†…å®¹ç‰¹æœ‰ä¿¡æ¯
- ğŸŸ  **éŸ³ä¹å­—æ®µ**ï¼šæ­Œæ‰‹ã€ä¸“è¾‘ã€æ›²é£ç­‰éŸ³ä¹ç‰¹æœ‰ç‰¹å¾
- ğŸŸ¡ **æ•™è‚²å­—æ®µ**ï¼šè®²å¸ˆã€éš¾åº¦ã€è¯¾æ—¶ç­‰è¯¾ç¨‹ç‰¹æœ‰ç»´åº¦
- ğŸŸ¢ **å†…å®¹å­—æ®µ**ï¼šå†…å®¹ç±»å‹ã€è¯é¢˜ã€è´¨é‡åˆ†ç­‰UGCå†…å®¹ç‰¹å¾
- ğŸ”´ **ç¤¾äº¤å­—æ®µ**ï¼šç”¨æˆ·ç”»åƒã€å½±å“åŠ›ã€å…³ç³»ç±»å‹ç­‰ç¤¾äº¤ç‰¹å¾
- ğŸŸª **ä¸ªæ€§åŒ–å­—æ®µ**ï¼šæ¨èåˆ†æ•°ã€åŒ¹é…ç†ç”±ã€æ¨èç­–ç•¥ç­‰å…ƒä¿¡æ¯

### é€šç”¨å¿…å¡«å­—æ®µ

æ‰€æœ‰åœºæ™¯éƒ½éœ€è¦åŒ…å«ä»¥ä¸‹æ ¸å¿ƒå­—æ®µï¼š

```json
{
  "item_id": "string",        // å¿…å¡«ï¼šç‰©å“å”¯ä¸€ID
  "metadata": {
    "title": "string",        // å¼ºçƒˆæ¨èï¼šç‰©å“æ ‡é¢˜ï¼ˆç”¨äºå‘é‡ç”Ÿæˆã€æœç´¢ï¼‰
    "description": "string",  // æ¨èï¼šç‰©å“æè¿°ï¼ˆç”¨äºå‘é‡ç”Ÿæˆï¼‰
    "category": "string",     // æ¨èï¼šåˆ†ç±»ï¼ˆç”¨äºåˆ†ç±»å¬å›ã€è¿‡æ»¤ï¼‰
    "tags": ["string"],       // æ¨èï¼šæ ‡ç­¾åˆ—è¡¨ï¼ˆç”¨äºæ ‡ç­¾å¬å›ã€ç›¸ä¼¼è®¡ç®—ï¼‰
    "publish_time": "ISO8601",// æ¨èï¼šå‘å¸ƒæ—¶é—´ï¼ˆç”¨äºæ—¶é—´è¡°å‡ã€æ–°ç‰©å“å†·å¯åŠ¨ï¼‰
    "cover_url": "string",    // å¯é€‰ï¼šå°é¢å›¾ï¼ˆå‰ç«¯å±•ç¤ºï¼‰
    "status": "active"        // å¯é€‰ï¼šçŠ¶æ€ï¼ˆactive/inactiveï¼‰
  }
}
```

### åœºæ™¯1ï¼šè§†é¢‘åœºæ™¯ï¼ˆvlogã€çŸ­è§†é¢‘ã€ç›´æ’­å›æ”¾ï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šæŠ–éŸ³ã€å¿«æ‰‹ã€Bç«™ã€YouTubeç±»å¹³å°

```json
{
  "item_id": "video_20241030_001",
  "metadata": {
    // é€šç”¨å­—æ®µ
    "title": "åŒ—äº¬ç§‹å¤©æ—…è¡ŒVlog | æ•…å®«æ‰“å¡",
    "description": "å¸¦ä½ é¢†ç•¥æ•…å®«ç§‹å¤©çš„ç¾æ™¯...",
    "cover_url": "https://cdn.example.com/cover.jpg",
    "tags": ["æ—…è¡Œ", "åŒ—äº¬", "æ•…å®«", "ç§‹å¤©"],
    "category": "travel",
    "publish_time": "2024-10-30T10:00:00Z",
    
    // è§†é¢‘ç‰¹æœ‰å­—æ®µ â­
    "video_url": "https://cdn.example.com/video.mp4",
    "duration": 180,              // è§†é¢‘æ—¶é•¿ï¼ˆç§’ï¼‰
    "resolution": "1080p",        // åˆ†è¾¨ç‡
    "format": "mp4",              // è§†é¢‘æ ¼å¼
    
    // åˆ›ä½œè€…ä¿¡æ¯
    "author": "æ—…è¡Œåšä¸»å°ç‹",
    "author_id": "user_123",
    "author_avatar": "https://cdn.example.com/avatar.jpg",
    "author_fans_count": 100000,  // ç²‰ä¸æ•°
    
    // ç»Ÿè®¡æ•°æ®ï¼ˆå¯é€‰ï¼Œå¯ç”±è¡Œä¸ºæ•°æ®å®æ—¶è®¡ç®—ï¼‰
    "view_count": 50000,          // æ’­æ”¾é‡
    "like_count": 3000,           // ç‚¹èµæ•°
    "comment_count": 500,         // è¯„è®ºæ•°
    "share_count": 200,           // åˆ†äº«æ•°
    "completion_rate": 0.75,      // å¹³å‡å®Œæ’­ç‡
    "avg_watch_duration": 135,    // å¹³å‡è§‚çœ‹æ—¶é•¿
    
    // å†…å®¹ç‰¹å¾
    "has_bgm": true,              // æ˜¯å¦æœ‰èƒŒæ™¯éŸ³ä¹
    "has_subtitles": true,        // æ˜¯å¦æœ‰å­—å¹•
    "language": "zh-CN"           // è¯­è¨€
  }
}
```

### åœºæ™¯2ï¼šç”µå•†åœºæ™¯ï¼ˆå•†å“æ¨èï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šæ·˜å®ã€äº¬ä¸œã€æ‹¼å¤šå¤šç±»ç”µå•†å¹³å°

```json
{
  "item_id": "product_SKU123456",
  "metadata": {
    // é€šç”¨å­—æ®µ
    "title": "Apple iPhone 15 Pro Max 256GB é’›é‡‘å±",
    "description": "æ­è½½A17 ProèŠ¯ç‰‡ï¼Œæ”¯æŒå«æ˜Ÿé€šè®¯...",
    "cover_url": "https://cdn.example.com/iphone.jpg",
    "tags": ["æ‰‹æœº", "è‹¹æœ", "5G", "é«˜ç«¯"],
    "category": "electronics/mobile",
    "publish_time": "2024-09-15T00:00:00Z",
    
    // ç”µå•†ç‰¹æœ‰å­—æ®µ â­
    "price": 9999.00,             // å½“å‰ä»·æ ¼
    "original_price": 10999.00,   // åŸä»·
    "discount": 0.91,             // æŠ˜æ‰£ç‡
    "currency": "CNY",            // è´§å¸
    "stock": 500,                 // åº“å­˜
    "brand": "Apple",             // å“ç‰Œ
    "model": "iPhone 15 Pro Max", // å‹å·
    "sku": "SKU123456",           // SKUç¼–ç 
    
    // å•†å“å±æ€§
    "color": "é’›é‡‘å±",            // é¢œè‰²
    "size": "6.7è‹±å¯¸",            // å°ºå¯¸
    "weight": 221,                // é‡é‡ï¼ˆå…‹ï¼‰
    "specs": {                    // è¯¦ç»†è§„æ ¼
      "storage": "256GB",
      "ram": "8GB",
      "chip": "A17 Pro"
    },
    
    // å•†å®¶ä¿¡æ¯
    "seller_id": "shop_apple_official",
    "seller_name": "Appleå®˜æ–¹æ——èˆ°åº—",
    "is_official": true,          // æ˜¯å¦å®˜æ–¹åº—
    
    // é”€å”®æ•°æ®
    "sales_count": 10000,         // é”€é‡
    "rating": 4.8,                // è¯„åˆ†
    "review_count": 5000,         // è¯„ä»·æ•°
    "return_rate": 0.02,          // é€€è´§ç‡
    
    // ç‰©æµä¿¡æ¯
    "shipping_free": true,        // æ˜¯å¦åŒ…é‚®
    "warehouse_location": "åŒ—äº¬", // ä»“åº“ä½ç½®
    "delivery_time": "24å°æ—¶å‘è´§" // å‘è´§æ—¶æ•ˆ
  }
}
```

### åœºæ™¯3ï¼šæ–°é—»/èµ„è®¯åœºæ™¯

**é€‚ç”¨åœºæ™¯**ï¼šä»Šæ—¥å¤´æ¡ã€è…¾è®¯æ–°é—»ã€çŸ¥ä¹ç±»å†…å®¹å¹³å°

```json
{
  "item_id": "article_20241030_001",
  "metadata": {
    // é€šç”¨å­—æ®µ
    "title": "AIæŠ€æœ¯çªç ´ï¼šGPT-5å³å°†å‘å¸ƒ",
    "description": "OpenAIå®£å¸ƒä¸‹ä¸€ä»£å¤§è¯­è¨€æ¨¡å‹...",
    "cover_url": "https://cdn.example.com/news.jpg",
    "tags": ["ç§‘æŠ€", "AI", "GPT", "OpenAI"],
    "category": "technology",
    "publish_time": "2024-10-30T08:00:00Z",
    
    // æ–°é—»ç‰¹æœ‰å­—æ®µ â­
    "content": "å®Œæ•´æ–‡ç« æ­£æ–‡...",   // å…¨æ–‡å†…å®¹ï¼ˆç”¨äºå‘é‡ç”Ÿæˆï¼‰
    "summary": "æ‘˜è¦...",          // æ–‡ç« æ‘˜è¦
    "word_count": 1500,           // å­—æ•°
    "reading_time": 5,            // é¢„è®¡é˜…è¯»æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
    
    // ä½œè€…/æ¥æº
    "author": "ç§‘æŠ€æ—¥æŠ¥",
    "author_id": "media_tech_daily",
    "source": "ç§‘æŠ€æ—¥æŠ¥å®˜æ–¹",
    "is_verified": true,          // æ˜¯å¦è®¤è¯åª’ä½“
    
    // å†…å®¹ç±»å‹
    "article_type": "news",       // ç±»å‹ï¼šnews/opinion/interview/report
    "has_video": false,           // æ˜¯å¦åŒ…å«è§†é¢‘
    "has_images": true,           // æ˜¯å¦åŒ…å«å›¾ç‰‡
    "image_count": 5,             // å›¾ç‰‡æ•°é‡
    
    // äº’åŠ¨æ•°æ®
    "view_count": 100000,
    "like_count": 5000,
    "comment_count": 800,
    "share_count": 1200,
    "collect_count": 3000,        // æ”¶è—æ•°
    
    // å†…å®¹ç‰¹å¾
    "sentiment": "neutral",       // æƒ…æ„Ÿå€¾å‘ï¼špositive/neutral/negative
    "keywords": ["AI", "GPT-5", "OpenAI", "å¤§è¯­è¨€æ¨¡å‹"],
    "entities": {                 // å®ä½“è¯†åˆ«
      "persons": ["Sam Altman"],
      "organizations": ["OpenAI"],
      "locations": ["ç¾å›½"]
    }
  }
}
```

### åœºæ™¯4ï¼šéŸ³ä¹åœºæ™¯

**é€‚ç”¨åœºæ™¯**ï¼šç½‘æ˜“äº‘éŸ³ä¹ã€QQéŸ³ä¹ã€Spotifyç±»éŸ³ä¹å¹³å°

```json
{
  "item_id": "song_123456",
  "metadata": {
    // é€šç”¨å­—æ®µ
    "title": "ä¸ƒé‡Œé¦™",
    "description": "å‘¨æ°ä¼¦ç»å…¸æ­Œæ›²",
    "cover_url": "https://cdn.example.com/album_cover.jpg",
    "tags": ["æµè¡Œ", "åè¯­", "ç»å…¸"],
    "category": "pop",
    "publish_time": "2004-08-03T00:00:00Z",
    
    // éŸ³ä¹ç‰¹æœ‰å­—æ®µ â­
    "audio_url": "https://cdn.example.com/song.mp3",
    "duration": 300,              // æ—¶é•¿ï¼ˆç§’ï¼‰
    "artist": "å‘¨æ°ä¼¦",           // æ­Œæ‰‹
    "artist_id": "artist_jay",
    "album": "ä¸ƒé‡Œé¦™",            // ä¸“è¾‘
    "album_id": "album_001",
    "genre": "pop",               // æ›²é£ï¼špop/rock/jazz/classical
    "language": "zh-CN",          // è¯­è¨€
    
    // éŸ³é¢‘ç‰¹å¾
    "bpm": 120,                   // èŠ‚æ‹ï¼ˆBPMï¼‰
    "key": "C major",             // è°ƒæ€§
    "mood": "romantic",           // æƒ…ç»ªï¼šhappy/sad/romantic/energetic
    "tempo": "moderate",          // èŠ‚å¥ï¼šslow/moderate/fast
    
    // è´¨é‡ä¿¡æ¯
    "bitrate": 320,               // æ¯”ç‰¹ç‡ï¼ˆkbpsï¼‰
    "format": "mp3",              // æ ¼å¼
    "quality": "high",            // éŸ³è´¨ï¼šlow/medium/high/lossless
    
    // ç‰ˆæƒä¿¡æ¯
    "copyright": "æ°å¨å°”éŸ³ä¹",
    "is_vip_only": false,         // æ˜¯å¦ä¼šå‘˜ä¸“äº«
    "is_downloadable": true,      // æ˜¯å¦å¯ä¸‹è½½
    
    // ç»Ÿè®¡æ•°æ®
    "play_count": 500000000,      // æ’­æ”¾é‡
    "like_count": 10000000,       // å–œæ¬¢æ•°
    "collect_count": 5000000,     // æ”¶è—æ•°
    "comment_count": 100000       // è¯„è®ºæ•°
  }
}
```

### åœºæ™¯5ï¼šæ•™è‚²åœºæ™¯ï¼ˆè¯¾ç¨‹ã€çŸ¥è¯†ä»˜è´¹ï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šå¾—åˆ°ã€æå®¢æ—¶é—´ã€Bç«™è¯¾ç¨‹ç±»æ•™è‚²å¹³å°

```json
{
  "item_id": "course_python_101",
  "metadata": {
    // é€šç”¨å­—æ®µ
    "title": "Pythoné›¶åŸºç¡€å…¥é—¨åˆ°ç²¾é€š",
    "description": "å…¨é¢ç³»ç»Ÿçš„Pythonç¼–ç¨‹è¯¾ç¨‹...",
    "cover_url": "https://cdn.example.com/course_cover.jpg",
    "tags": ["ç¼–ç¨‹", "Python", "å…¥é—¨", "åç«¯"],
    "category": "programming/backend",
    "publish_time": "2024-01-01T00:00:00Z",
    
    // æ•™è‚²ç‰¹æœ‰å­—æ®µ â­
    "instructor": "å¼ è€å¸ˆ",       // è®²å¸ˆ
    "instructor_id": "teacher_zhang",
    "instructor_title": "èµ„æ·±Pythonå·¥ç¨‹å¸ˆ", // è®²å¸ˆå¤´è¡”
    
    // è¯¾ç¨‹ä¿¡æ¯
    "course_type": "video",       // ç±»å‹ï¼švideo/audio/text/live
    "difficulty": "beginner",     // éš¾åº¦ï¼šbeginner/intermediate/advanced
    "duration": 36000,            // æ€»æ—¶é•¿ï¼ˆç§’ï¼Œ10å°æ—¶ï¼‰
    "lesson_count": 100,          // è¯¾æ—¶æ•°
    "chapter_count": 10,          // ç« èŠ‚æ•°
    
    // ä»·æ ¼ä¿¡æ¯
    "price": 199.00,              // ä»·æ ¼
    "original_price": 299.00,     // åŸä»·
    "is_free": false,             // æ˜¯å¦å…è´¹
    "has_trial": true,            // æ˜¯å¦æœ‰è¯•çœ‹
    
    // å­¦ä¹ æ•°æ®
    "student_count": 50000,       // å­¦å‘˜æ•°
    "completion_rate": 0.65,      // å®Œè¯¾ç‡
    "avg_study_time": 7200,       // å¹³å‡å­¦ä¹ æ—¶é•¿
    "rating": 4.9,                // è¯„åˆ†
    "review_count": 3000,         // è¯„ä»·æ•°
    
    // å†…å®¹ç‰¹å¾
    "has_homework": true,         // æ˜¯å¦æœ‰ä½œä¸š
    "has_certificate": true,      // æ˜¯å¦æœ‰è¯ä¹¦
    "has_qa": true,               // æ˜¯å¦æœ‰é—®ç­”
    "update_status": "completed", // æ›´æ–°çŠ¶æ€ï¼šongoing/completed
    "last_update": "2024-06-01T00:00:00Z", // æœ€åæ›´æ–°æ—¶é—´
    
    // é€‚ç”¨äººç¾¤
    "target_audience": ["ç¼–ç¨‹æ–°æ‰‹", "åœ¨æ ¡å­¦ç”Ÿ", "è½¬è¡Œäººç¾¤"],
    "prerequisites": ["æ— éœ€åŸºç¡€"],  // å‰ç½®è¦æ±‚
    "learning_outcomes": [         // å­¦ä¹ æ”¶è·
      "æŒæ¡PythonåŸºç¡€è¯­æ³•",
      "èƒ½å¤Ÿå¼€å‘ç®€å•çš„Webåº”ç”¨",
      "äº†è§£æ•°æ®åˆ†æåŸºç¡€"
    ]
  }
}
```

### åœºæ™¯6ï¼šå†…å®¹æ¨èåœºæ™¯ï¼ˆUGCå†…å®¹ã€å¸–å­ã€é—®ç­”ï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šçŸ¥ä¹ã€å°çº¢ä¹¦ã€å¾®åšç±»UGCå†…å®¹å¹³å°

```json
{
  "item_id": "post_20241030_001",
  "metadata": {
    // é€šç”¨å­—æ®µ
    "title": "æ·±åº¦å­¦ä¹ å®æˆ˜ï¼šä»é›¶æ­å»ºæ¨èç³»ç»Ÿ",
    "description": "è¯¦ç»†ä»‹ç»å¦‚ä½•ä»é›¶å¼€å§‹æ­å»ºä¸€ä¸ªå®Œæ•´çš„æ¨èç³»ç»Ÿ...",
    "cover_url": "https://cdn.example.com/post_cover.jpg",
    "tags": ["æŠ€æœ¯", "æ¨èç³»ç»Ÿ", "æ·±åº¦å­¦ä¹ ", "å®æˆ˜"],
    "category": "tech/ai",
    "publish_time": "2024-10-30T10:00:00Z",
    
    // å†…å®¹ç‰¹æœ‰å­—æ®µ â­
    "content_type": "post",            // å†…å®¹ç±»å‹ï¼špost/question/answer/gallery/thread
    "content": "å®Œæ•´å†…å®¹æ­£æ–‡...",      // æ­£æ–‡ï¼ˆå¯é€‰ï¼Œå¯èƒ½è¾ƒé•¿ï¼‰
    "word_count": 2500,                // å­—æ•°
    "image_count": 8,                  // å›¾ç‰‡æ•°é‡
    "video_count": 1,                  // è§†é¢‘æ•°é‡
    "link_count": 3,                   // é“¾æ¥æ•°é‡
    
    // ä½œè€…ä¿¡æ¯
    "author": "æŠ€æœ¯å¤§ç‰›",
    "author_id": "user_tech_expert",
    "author_level": "èµ„æ·±ä½œè€…",        // ä½œè€…ç­‰çº§
    "author_avatar": "https://cdn.example.com/avatar.jpg",
    "author_fans_count": 80000,        // ç²‰ä¸æ•°
    "author_post_count": 500,          // å‘å¸–æ•°
    
    // è¯é¢˜ä¸è´¨é‡
    "topic": "äººå·¥æ™ºèƒ½æŠ€æœ¯",           // ä¸»è¯é¢˜
    "topics": ["æ¨èç³»ç»Ÿ", "æ·±åº¦å­¦ä¹ ", "Python"],  // ç›¸å…³è¯é¢˜
    "content_quality_score": 92,       // å†…å®¹è´¨é‡åˆ†ï¼ˆ0-100ï¼‰
    "is_original": true,               // æ˜¯å¦åŸåˆ›
    "has_hashtags": true,              // æ˜¯å¦æœ‰æ ‡ç­¾
    "hashtags": ["#æ¨èç³»ç»Ÿ", "#æ·±åº¦å­¦ä¹ ", "#å®æˆ˜æ•™ç¨‹"],
    
    // äº’åŠ¨æ•°æ®
    "view_count": 50000,
    "like_count": 3500,
    "comment_count": 280,
    "share_count": 450,
    "collect_count": 1200,             // æ”¶è—æ•°
    "engagement_rate": 0.098,          // äº’åŠ¨ç‡
    
    // å†…å®¹ç‰¹å¾
    "read_time_estimate": 600,         // é¢„è®¡é˜…è¯»æ—¶é•¿ï¼ˆç§’ï¼‰
    "has_code_snippet": true,          // æ˜¯å¦åŒ…å«ä»£ç 
    "has_external_links": true,        // æ˜¯å¦æœ‰å¤–é“¾
    "language": "zh-CN",               // è¯­è¨€
    "content_format": "markdown"       // å†…å®¹æ ¼å¼
  }
}
```

### åœºæ™¯7ï¼šç¤¾äº¤æ¨èåœºæ™¯ï¼ˆå¥½å‹æ¨èã€å…³æ³¨æ¨èï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šç¤¾äº¤ç½‘ç»œå¹³å°çš„å¥½å‹/å…³æ³¨æ¨è

```json
{
  "item_id": "user_profile_123456",
  "metadata": {
    // é€šç”¨å­—æ®µ
    "title": "ææ˜ - èµ„æ·±äº§å“ç»ç†",
    "description": "10å¹´äº§å“ç»éªŒï¼Œä¸“æ³¨äºAIå’Œæ¨èç³»ç»Ÿ...",
    "cover_url": "https://cdn.example.com/profile_bg.jpg",
    "tags": ["äº§å“ç»ç†", "AI", "æ¨èç³»ç»Ÿ", "åˆ›ä¸š"],
    "category": "professional/pm",
    "publish_time": "2020-01-01T00:00:00Z",  // æ³¨å†Œæ—¶é—´
    
    // ç¤¾äº¤ç‰¹æœ‰å­—æ®µ â­
    "user_profile": {
      "username": "liming_pm",
      "nickname": "ææ˜",
      "avatar": "https://cdn.example.com/avatar_liming.jpg",
      "gender": "male",
      "age": 32,
      "location": "åŒ—äº¬å¸‚",
      "bio": "çƒ­çˆ±äº§å“ï¼Œçƒ­çˆ±æŠ€æœ¯"
    },
    
    // ç¤¾äº¤æ•°æ®
    "follower_count": 15000,           // ç²‰ä¸æ•°
    "following_count": 500,            // å…³æ³¨æ•°
    "post_count": 800,                 // å‘å¸–æ•°
    "influence_score": 85.5,           // å½±å“åŠ›åˆ†æ•°ï¼ˆ0-100ï¼‰
    "activity_level": "high",          // æ´»è·ƒåº¦ï¼šlow/medium/high
    
    // å…³ç³»ç±»å‹ï¼ˆé’ˆå¯¹å½“å‰ç”¨æˆ·ï¼‰
    "relationship_type": "suggested",  // å…³ç³»ï¼šfriend/following/mutual/suggested/stranger
    "mutual_friends_count": 12,        // å…±åŒå¥½å‹æ•°
    "social_distance": 2,              // ç¤¾äº¤è·ç¦»ï¼ˆåº¦æ•°ï¼‰
    "interaction_frequency": "medium", // äº’åŠ¨é¢‘ç‡ï¼šlow/medium/high
    
    // å…´è¶£ä¸åŒ¹é…
    "common_interests": ["AI", "äº§å“è®¾è®¡", "åˆ›ä¸š"],  // å…±åŒå…´è¶£
    "similarity_score": 0.78,          // ç›¸ä¼¼åº¦åˆ†æ•°
    "interests": ["äº§å“", "AI", "æ¨èç³»ç»Ÿ", "åˆ›ä¸š", "é˜…è¯»"],
    
    // è®¤è¯ä¸æ ‡ç­¾
    "is_verified": true,               // æ˜¯å¦è®¤è¯
    "verification_type": "personal",   // è®¤è¯ç±»å‹ï¼špersonal/company/media
    "badges": ["èµ„æ·±ç”¨æˆ·", "ä¼˜è´¨åˆ›ä½œè€…", "æŠ€æœ¯è¾¾äºº"],
    
    // ç»Ÿè®¡æ•°æ®
    "avg_post_engagement": 0.05,       // å¹³å‡å¸–å­äº’åŠ¨ç‡
    "last_active_time": "2024-10-30T09:00:00Z",  // æœ€åæ´»è·ƒæ—¶é—´
    "account_age_days": 1764,          // è´¦å·å¹´é¾„ï¼ˆå¤©ï¼‰
    
    // èŒä¸šä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
    "profession": "äº§å“ç»ç†",
    "company": "æŸç§‘æŠ€å…¬å¸",
    "industry": "äº’è”ç½‘",
    "education": "æ¸…åå¤§å­¦"
  }
}
```

### åœºæ™¯8ï¼šä¸ªæ€§åŒ–æ¨èåœºæ™¯ï¼ˆç»¼åˆæ¨èã€Feedæµï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šä¸ªæ€§åŒ–Feedæµã€ç»¼åˆå†…å®¹æ¨è

```json
{
  "item_id": "personalized_item_001",
  "metadata": {
    // é€šç”¨å­—æ®µ
    "title": "ä¸ªæ€§åŒ–æ¨èå†…å®¹",
    "description": "åŸºäºä½ çš„å…´è¶£æ¨è...",
    "cover_url": "https://cdn.example.com/cover.jpg",
    "tags": ["ä¸ªæ€§åŒ–", "æ¨è"],
    "category": "personalized",
    "publish_time": "2024-10-30T10:00:00Z",
    
    // ä¸ªæ€§åŒ–ç‰¹æœ‰å­—æ®µ â­
    "personalization_score": 0.92,     // ä¸ªæ€§åŒ–åˆ†æ•°ï¼ˆ0-1ï¼‰
    "match_reasons": [                 // æ¨èç†ç”±
      "å…´è¶£åŒ¹é…åº¦92%",
      "å¥½å‹éƒ½åœ¨çœ‹",
      "çƒ­é—¨å†…å®¹",
      "æ–°é²œå†…å®¹"
    ],
    "primary_reason": "å…´è¶£åŒ¹é…",      // ä¸»è¦æ¨èç†ç”±
    
    // ç”¨æˆ·åŒ¹é…åº¦
    "user_interests_match": 0.89,      // ç”¨æˆ·å…´è¶£åŒ¹é…åº¦
    "matched_interests": ["AI", "æŠ€æœ¯", "åˆ›ä¸š"],  // åŒ¹é…çš„å…´è¶£ç‚¹
    "user_profile_match": 0.75,        // ç”¨æˆ·ç”»åƒåŒ¹é…åº¦
    
    // å†…å®¹çƒ­åº¦ä¸æ–°é¢–åº¦
    "trending_score": 0.85,            // çƒ­åº¦åˆ†æ•°
    "novelty_score": 0.68,             // æ–°é¢–åº¦åˆ†æ•°
    "recency_score": 0.72,             // æ—¶æ•ˆæ€§åˆ†æ•°
    "quality_score": 0.88,             // è´¨é‡åˆ†æ•°
    
    // æ¨èç­–ç•¥
    "recommendation_strategy": "hybrid",  // æ¨èç­–ç•¥ï¼šcollaborative/content_based/hybrid/deep_learning
    "model_version": "v3.2",           // æ¨¡å‹ç‰ˆæœ¬
    "algorithm": "two_tower_dnn",      // ä½¿ç”¨çš„ç®—æ³•
    
    // å¤šæ ·æ€§æ§åˆ¶
    "diversity_group": "tech_content", // å¤šæ ·æ€§åˆ†ç»„
    "content_freshness": "recent",     // å†…å®¹æ–°é²œåº¦ï¼šnew/recent/old
    
    // ç‰¹å¾æƒé‡ï¼ˆå¯é€‰ï¼Œç”¨äºè§£é‡Šï¼‰
    "feature_importance": {
      "collaborative_filtering": 0.35,
      "content_similarity": 0.25,
      "popularity": 0.20,
      "novelty": 0.10,
      "social_influence": 0.10
    },
    
    // é¢„æµ‹æŒ‡æ ‡
    "predicted_ctr": 0.08,             // é¢„æµ‹ç‚¹å‡»ç‡
    "predicted_engagement": 0.12,      // é¢„æµ‹äº’åŠ¨ç‡
    "predicted_dwell_time": 180,       // é¢„æµ‹åœç•™æ—¶é•¿ï¼ˆç§’ï¼‰
    
    // ABå®éªŒä¿¡æ¯
    "experiment_id": "exp_personalized_v2",
    "experiment_group": "treatment",
    "model_confidence": 0.85,          // æ¨¡å‹ç½®ä¿¡åº¦
    
    // åŸå§‹ç‰©å“ä¿¡æ¯å¼•ç”¨
    "source_item_id": "article_123",   // æºç‰©å“ID
    "source_item_type": "article",     // æºç‰©å“ç±»å‹
    "source_scenario": "news"          // æºåœºæ™¯
  }
}
```

### åœºæ™¯9ï¼šè‡ªå®šä¹‰åœºæ™¯

å¦‚æœæ‚¨çš„ä¸šåŠ¡åœºæ™¯ä¸åœ¨ä¸Šè¿°èŒƒå›´å†…ï¼Œå¯ä»¥è‡ªå®šä¹‰`metadata`å­—æ®µï¼š

```json
{
  "item_id": "custom_item_001",
  "metadata": {
    // è‡³å°‘åŒ…å«åŸºç¡€å­—æ®µ
    "title": "ç‰©å“æ ‡é¢˜",
    "description": "ç‰©å“æè¿°",
    "category": "è‡ªå®šä¹‰åˆ†ç±»",
    "tags": ["æ ‡ç­¾1", "æ ‡ç­¾2"],
    
    // è‡ªå®šä¹‰å­—æ®µï¼ˆä»»æ„JSONç»“æ„ï¼‰
    "custom_field_1": "value1",
    "custom_field_2": 123,
    "custom_nested": {
      "key": "value"
    }
  }
}
```

### å­—æ®µè®¾è®¡åŸåˆ™ âš ï¸

1. **å¿…å¡«å­—æ®µæœ€å°åŒ–**ï¼šåªæœ‰`item_id`æ˜¯å¿…å¡«ï¼Œå…¶ä»–å­—æ®µæ ¹æ®åœºæ™¯é€‰æ‹©
2. **æ¨èç³»ç»Ÿä¼˜åŒ–å­—æ®µ**ï¼š
   - `title` + `description` â†’ ç”¨äºç”Ÿæˆæ–‡æœ¬å‘é‡ï¼ˆç›¸ä¼¼æ¨èï¼‰
   - `tags` â†’ ç”¨äºæ ‡ç­¾å¬å›
   - `category` â†’ ç”¨äºåˆ†ç±»è¿‡æ»¤
   - `publish_time` â†’ ç”¨äºæ—¶é—´è¡°å‡ã€æ–°ç‰©å“å†·å¯åŠ¨
   - ç»Ÿè®¡æ•°æ®ï¼ˆæ’­æ”¾é‡ã€ç‚¹èµæ•°ç­‰ï¼‰ â†’ ç”¨äºçƒ­åº¦æ’åº
3. **é¿å…é‡å¤è®¡ç®—**ï¼šç»Ÿè®¡æ•°æ®ï¼ˆå¦‚`view_count`ï¼‰å¯ç”±è¡Œä¸ºæ•°æ®å®æ—¶è®¡ç®—ï¼Œæ— éœ€æ¯æ¬¡æ›´æ–°ç‰©å“
4. **å‘é‡ç”Ÿæˆå­—æ®µ**ï¼šåŒ…å«ä¸°å¯Œæ–‡æœ¬ä¿¡æ¯çš„å­—æ®µï¼ˆ`title`ã€`description`ã€`tags`ï¼‰å°†ç”¨äºç”Ÿæˆå‘é‡è¡¨ç¤º

---

## ğŸ”„ å®Œæ•´æ•°æ®æµå‘

ç‰©å“æ•°æ®ä»æ¥å…¥åˆ°æ¨èå¬å›çš„å®Œæ•´æµç¨‹å¦‚ä¸‹ï¼š

### Mermaidå¯è§†åŒ–æµç¨‹å›¾

```mermaid
graph TB
    Start[ä¸šåŠ¡ç³»ç»Ÿ<br/>å†…å®¹å‘å¸ƒ/å•†å“ä¸Šæ¶] --> Choice{é€‰æ‹©æ¥å…¥æ–¹å¼}
    
    Choice -->|å®æ—¶å‘å¸ƒ| API[HTTP APIæ¨é€<br/>POST /api/v1/items/batch]
    Choice -->|æ‰¹é‡å¯¼å…¥| Kafka[Kafkaæ¶ˆæ¯é˜Ÿåˆ—<br/>Topic: items-ingest]
    
    API --> Validation[æ•°æ®éªŒè¯ä¸å­˜å‚¨<br/>ItemService]
    Kafka --> Validation
    
    Validation --> MongoDB[(MongoDB<br/>itemsé›†åˆ<br/>çµæ´»Schema)]
    
    MongoDB --> KafkaEvent[å‘é€Kafkaäº‹ä»¶<br/>item-events-{tenant_id}]
    
    KafkaEvent --> Parallel{å¹¶è¡Œå¤„ç†}
    
    Parallel --> Embedding[å‘é‡ç”Ÿæˆ<br/>EmbeddingService]
    Parallel --> Feature[ç‰¹å¾å·¥ç¨‹<br/>FeatureService]
    
    Embedding --> EmbModel[è°ƒç”¨å‘é‡æ¨¡å‹<br/>OpenAI/BGE/M3E]
    EmbModel --> Milvus[(Milvus<br/>å‘é‡æ•°æ®åº“<br/>IVF_FLAT/HNSWç´¢å¼•)]
    
    Feature --> FeatureExtract[æå–ç‰¹å¾<br/>ç±»ç›®/ç»Ÿè®¡/æ—¶é—´/å†…å®¹]
    FeatureExtract --> Redis1[(Redis<br/>ç‰¹å¾ç¼“å­˜<br/>item:features:*)]
    
    Milvus --> Index[ç´¢å¼•æ„å»º]
    Redis1 --> Index
    MongoDB --> Index
    
    Index --> Redis2[(Redis ZSET<br/>çƒ­åº¦ç´¢å¼•<br/>hot:items:*)]
    
    subgraph ç¦»çº¿æ¨¡å‹è®­ç»ƒ
        ClickHouse[(ClickHouse<br/>è¡Œä¸ºæ•°æ®)] --> DataPrep[æ•°æ®å‡†å¤‡<br/>æ ·æœ¬æ„å»º]
        MongoDB --> DataPrep
        DataPrep --> Training[æ¨¡å‹è®­ç»ƒ<br/>LightGBM/DeepFM/åŒå¡”]
        Training --> Evaluation[æ¨¡å‹è¯„ä¼°<br/>AUC/NDCG/CTR]
        Evaluation --> Deploy[æ¨¡å‹éƒ¨ç½²<br/>æ›´æ–°é…ç½®]
    end
    
    subgraph åœ¨çº¿æ¨èæœåŠ¡
        Request[ç”¨æˆ·è¯·æ±‚æ¨è] --> Recall[å¬å›é˜¶æ®µ<br/>å¤šè·¯å¬å›]
        
        Milvus --> Recall
        Redis2 --> Recall
        MongoDB --> Recall
        
        Recall --> CoarseRank[ç²—æ’é˜¶æ®µ<br/>ç®€å•è¿‡æ»¤]
        CoarseRank --> FineRank[ç²¾æ’é˜¶æ®µ<br/>LightGBM/DeepFM]
        
        Deploy -.->|åŠ è½½æ¨¡å‹| FineRank
        
        FineRank --> ReRank[é‡æ’é˜¶æ®µ<br/>å¤šæ ·æ€§/ä¸šåŠ¡è§„åˆ™]
        ReRank --> Result[æ¨èç»“æœ<br/>Top20]
    end
    
    Result --> Behavior[ç”¨æˆ·è¡Œä¸ºåŸ‹ç‚¹<br/>æ›å…‰/ç‚¹å‡»/è½¬åŒ–]
    Behavior --> ClickHouse
    
    ClickHouse --> Monitor[æ•ˆæœç›‘æ§<br/>Grafanaå¤§ç›˜]
    Monitor -.->|æ¨¡å‹è¿­ä»£| Training
    
    style Start fill:#e1f5ff
    style API fill:#fff4e1
    style Kafka fill:#fff4e1
    style MongoDB fill:#e8f5e9
    style Milvus fill:#e8f5e9
    style Redis1 fill:#e8f5e9
    style Redis2 fill:#e8f5e9
    style ClickHouse fill:#e8f5e9
    style Result fill:#f3e5f5
    style Monitor fill:#f3e5f5
```

**æµç¨‹è¯´æ˜**ï¼š
- ğŸŸ¦ **è“è‰²**ï¼šæ•°æ®æºï¼ˆä¸šåŠ¡ç³»ç»Ÿï¼‰
- ğŸŸ¨ **é»„è‰²**ï¼šæ¥å…¥å±‚ï¼ˆAPI/Kafkaï¼‰
- ğŸŸ© **ç»¿è‰²**ï¼šå­˜å‚¨å±‚ï¼ˆMongoDB/Milvus/Redis/ClickHouseï¼‰
- ğŸŸª **ç´«è‰²**ï¼šè¾“å‡ºå±‚ï¼ˆæ¨èç»“æœã€ç›‘æ§ï¼‰

### ASCIIè‰ºæœ¯æµç¨‹å›¾ï¼ˆè¯¦ç»†ç‰ˆï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          1ï¸âƒ£ ç‰©å“æ•°æ®æ¥å…¥                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  ä¸šåŠ¡ç³»ç»Ÿï¼ˆå†…å®¹å‘å¸ƒã€å•†å“ä¸Šæ¶ç­‰ï¼‰                                      â”‚
â”‚       â”‚                                                               â”‚
â”‚       â”œâ”€â”€â–º HTTP API: POST /api/v1/items/batch                        â”‚
â”‚       â”‚    â€¢ ç®€å•æ˜“ç”¨                                                 â”‚
â”‚       â”‚    â€¢ åŒæ­¥ç¡®è®¤                                                 â”‚
â”‚       â”‚    â€¢ é€‚åˆå°è§„æ¨¡                                               â”‚
â”‚       â”‚                                                               â”‚
â”‚       â””â”€â”€â–º Kafka: Topic=items-ingest                                 â”‚
â”‚            â€¢ é«˜åå                                                   â”‚
â”‚            â€¢ å¼‚æ­¥è§£è€¦                                                 â”‚
â”‚            â€¢ é€‚åˆå¤§è§„æ¨¡                                               â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       2ï¸âƒ£ æ•°æ®éªŒè¯ä¸å­˜å‚¨                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  ItemService (Python)                                                â”‚
â”‚       â”‚                                                               â”‚
â”‚       â”œâ”€â”€â–º æ•°æ®éªŒè¯ï¼ˆtenant_idã€item_idã€å¿…å¡«å­—æ®µï¼‰                   â”‚
â”‚       â”œâ”€â”€â–º å»é‡æ£€æŸ¥ï¼ˆé¿å…é‡å¤æ’å…¥ï¼‰                                   â”‚
â”‚       â”œâ”€â”€â–º MongoDBå­˜å‚¨                                                â”‚
â”‚       â”‚    â€¢ Collection: items                                       â”‚
â”‚       â”‚    â€¢ Index: {tenant_id, scenario_id, item_id}                â”‚
â”‚       â”‚    â€¢ çµæ´»Schemaï¼ˆmetadataä¸ºJSONï¼‰                            â”‚
â”‚       â”‚                                                               â”‚
â”‚       â””â”€â”€â–º è¿”å›å¤„ç†ç»“æœ                                               â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       3ï¸âƒ£ äº‹ä»¶åˆ†å‘ï¼ˆKafkaï¼‰                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  KafkaProducer                                                       â”‚
â”‚       â”‚                                                               â”‚
â”‚       â””â”€â”€â–º Topic: item-events-{tenant_id}                            â”‚
â”‚            â€¢ Message: {"event": "item_created", "item": {...}}       â”‚
â”‚            â€¢ Key: item_idï¼ˆä¿è¯é¡ºåºï¼‰                                 â”‚
â”‚            â€¢ è§¦å‘ä¸‹æ¸¸å¤„ç†                                             â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       4ï¸âƒ£ å‘é‡ç”Ÿæˆï¼ˆEmbeddingï¼‰                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  EmbeddingService (å¼‚æ­¥ä»»åŠ¡)                                         â”‚
â”‚       â”‚                                                               â”‚
â”‚       â”œâ”€â”€â–º ä»MongoDBè¯»å–ç‰©å“                                          â”‚
â”‚       â”œâ”€â”€â–º æå–æ–‡æœ¬ç‰¹å¾                                               â”‚
â”‚       â”‚    â€¢ title + description + tags                              â”‚
â”‚       â”‚    â€¢ åœºæ™¯ç‰¹å®šå­—æ®µï¼ˆå¦‚videoçš„authorã€productçš„brandï¼‰          â”‚
â”‚       â”‚                                                               â”‚
â”‚       â”œâ”€â”€â–º è°ƒç”¨å‘é‡æ¨¡å‹                                               â”‚
â”‚       â”‚    â€¢ OpenAI Embedding API                                    â”‚
â”‚       â”‚    â€¢ SentenceTransformerï¼ˆæœ¬åœ°ï¼‰                             â”‚
â”‚       â”‚    â€¢ BGE/M3Eï¼ˆä¸­æ–‡ä¼˜åŒ–ï¼‰                                      â”‚
â”‚       â”‚    â€¢ ç”Ÿæˆ512/768/1024ç»´å‘é‡                                   â”‚
â”‚       â”‚                                                               â”‚
â”‚       â”œâ”€â”€â–º å­˜å‚¨å‘é‡                                                   â”‚
â”‚       â”‚    â€¢ Milvusï¼ˆå‘é‡æ•°æ®åº“ï¼‰ â­ æ¨è                             â”‚
â”‚       â”‚    â€¢ MongoDBï¼ˆembeddingå­—æ®µï¼‰                                 â”‚
â”‚       â”‚                                                               â”‚
â”‚       â””â”€â”€â–º æ›´æ–°çŠ¶æ€                                                   â”‚
â”‚            â€¢ MongoDB: {embedding_generated: true}                    â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       5ï¸âƒ£ ç‰¹å¾å·¥ç¨‹                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  FeatureService                                                      â”‚
â”‚       â”‚                                                               â”‚
â”‚       â”œâ”€â”€â–º æå–ç‰©å“ç‰¹å¾                                               â”‚
â”‚       â”‚    â€¢ ç±»ç›®ç‰¹å¾ï¼šcategoryã€tags                                 â”‚
â”‚       â”‚    â€¢ ç»Ÿè®¡ç‰¹å¾ï¼šview_countã€like_countã€CTR                    â”‚
â”‚       â”‚    â€¢ æ—¶é—´ç‰¹å¾ï¼špublish_timeã€freshness_score                  â”‚
â”‚       â”‚    â€¢ å†…å®¹ç‰¹å¾ï¼šdurationã€priceã€difficulty                    â”‚
â”‚       â”‚    â€¢ è´¨é‡ç‰¹å¾ï¼šratingã€completion_rate                        â”‚
â”‚       â”‚                                                               â”‚
â”‚       â”œâ”€â”€â–º ç‰¹å¾å½’ä¸€åŒ–/ç¼–ç                                             â”‚
â”‚       â”‚    â€¢ æ•°å€¼ç‰¹å¾ï¼šMinMaxScalerã€StandardScaler                  â”‚
â”‚       â”‚    â€¢ ç±»åˆ«ç‰¹å¾ï¼šOneHotEncodingã€LabelEncoding                 â”‚
â”‚       â”‚    â€¢ æ–‡æœ¬ç‰¹å¾ï¼šTF-IDFã€Word2Vec                               â”‚
â”‚       â”‚                                                               â”‚
â”‚       â””â”€â”€â–º å­˜å‚¨ç‰¹å¾                                                   â”‚
â”‚            â€¢ Redis: item:features:{item_id} â†’ HASH                   â”‚
â”‚            â€¢ MongoDB: itemsè¡¨å¢åŠ featureså­—æ®µ                         â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       6ï¸âƒ£ ç´¢å¼•æ„å»º                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  å¤šç§ç´¢å¼•å¹¶è¡Œæ„å»º                                                      â”‚
â”‚                                                                       â”‚
â”‚  â”œâ”€â”€â–º å‘é‡ç´¢å¼•ï¼ˆMilvusï¼‰                                             â”‚
â”‚  â”‚    â€¢ IVF_FLAT / HNSW ç´¢å¼•                                         â”‚
â”‚  â”‚    â€¢ æ”¯æŒANNï¼ˆè¿‘ä¼¼æœ€è¿‘é‚»ï¼‰æœç´¢                                     â”‚
â”‚  â”‚    â€¢ ç”¨äºç›¸ä¼¼ç‰©å“å¬å›                                              â”‚
â”‚  â”‚                                                                   â”‚
â”‚  â”œâ”€â”€â–º å€’æ’ç´¢å¼•ï¼ˆElasticsearchï¼‰å¯é€‰                                  â”‚
â”‚  â”‚    â€¢ æ ‡é¢˜ã€æ ‡ç­¾ã€åˆ†ç±»ç´¢å¼•                                          â”‚
â”‚  â”‚    â€¢ æ”¯æŒå…¨æ–‡æœç´¢                                                  â”‚
â”‚  â”‚                                                                   â”‚
â”‚  â”œâ”€â”€â–º çƒ­åº¦ç´¢å¼•ï¼ˆRedis ZSETï¼‰                                         â”‚
â”‚  â”‚    â€¢ Key: hot:items:{tenant}:{scenario}                          â”‚
â”‚  â”‚    â€¢ Score: çƒ­åº¦åˆ†æ•°ï¼ˆåŠ æƒè®¡ç®—ï¼‰                                   â”‚
â”‚  â”‚    â€¢ ç”¨äºçƒ­é—¨å¬å›                                                  â”‚
â”‚  â”‚                                                                   â”‚
â”‚  â””â”€â”€â–º ç±»ç›®ç´¢å¼•ï¼ˆMongoDB Indexï¼‰                                      â”‚
â”‚       â€¢ Index: {tenant_id, scenario_id, "metadata.category"}        â”‚
â”‚       â€¢ ç”¨äºåˆ†ç±»ç­›é€‰                                                  â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       7ï¸âƒ£ æ¨èå¬å›                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  RecallServiceï¼ˆå¤šè·¯å¬å›ï¼‰                                            â”‚
â”‚       â”‚                                                               â”‚
â”‚       â”œâ”€â”€â–º ååŒè¿‡æ»¤å¬å›ï¼ˆUserCF/ItemCFï¼‰                             â”‚
â”‚       â”‚    â€¢ åŸºäºè¡Œä¸ºæ•°æ®è®¡ç®—ç›¸ä¼¼åº¦                                    â”‚
â”‚       â”‚    â€¢ ä»MongoDB/Redisè¯»å–ç”¨æˆ·å†å²è¡Œä¸º                          â”‚
â”‚       â”‚    â€¢ å¬å›Top100                                               â”‚
â”‚       â”‚                                                               â”‚
â”‚       â”œâ”€â”€â–º å‘é‡å¬å›ï¼ˆEmbedding Basedï¼‰â­ æ ¸å¿ƒ                        â”‚
â”‚       â”‚    â€¢ ä»MilvusæŸ¥è¯¢ç›¸ä¼¼å‘é‡                                     â”‚
â”‚       â”‚    â€¢ ä½™å¼¦ç›¸ä¼¼åº¦/æ¬§æ°è·ç¦»                                       â”‚
â”‚       â”‚    â€¢ å¬å›Top100                                               â”‚
â”‚       â”‚                                                               â”‚
â”‚       â”œâ”€â”€â–º çƒ­é—¨å¬å›ï¼ˆHot Itemsï¼‰                                     â”‚
â”‚       â”‚    â€¢ ä»Redis ZSETè·å–çƒ­é—¨ç‰©å“                                 â”‚
â”‚       â”‚    â€¢ æŒ‰çƒ­åº¦Scoreæ’åº                                          â”‚
â”‚       â”‚    â€¢ å¬å›Top50                                                â”‚
â”‚       â”‚                                                               â”‚
â”‚       â”œâ”€â”€â–º æ ‡ç­¾å¬å›ï¼ˆTag Basedï¼‰                                     â”‚
â”‚       â”‚    â€¢ åŒ¹é…ç”¨æˆ·å…´è¶£æ ‡ç­¾                                          â”‚
â”‚       â”‚    â€¢ ä»MongoDBæŒ‰tagsæŸ¥è¯¢                                      â”‚
â”‚       â”‚    â€¢ å¬å›Top50                                                â”‚
â”‚       â”‚                                                               â”‚
â”‚       â””â”€â”€â–º æ–°ç‰©å“å¬å›ï¼ˆNew Itemsï¼‰                                   â”‚
â”‚            â€¢ æŒ‰publish_timeé™åº                                      â”‚
â”‚            â€¢ å†·å¯åŠ¨ç­–ç•¥                                                â”‚
â”‚            â€¢ å¬å›Top30                                                â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       8ï¸âƒ£ æ¨¡å‹è®­ç»ƒï¼ˆç¦»çº¿ï¼‰                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  ModelTrainingService (Celeryå®šæ—¶ä»»åŠ¡)                               â”‚
â”‚       â”‚                                                               â”‚
â”‚       â”œâ”€â”€â–º æ•°æ®å‡†å¤‡                                                   â”‚
â”‚       â”‚    â€¢ ClickHouseè¯»å–è¡Œä¸ºæ•°æ®ï¼ˆæ›å…‰ã€ç‚¹å‡»ã€è½¬åŒ–ï¼‰               â”‚
â”‚       â”‚    â€¢ MongoDBè¯»å–ç‰©å“ç‰¹å¾                                      â”‚
â”‚       â”‚    â€¢ æ„å»ºè®­ç»ƒæ ·æœ¬ï¼ˆæ­£è´Ÿæ ·æœ¬ï¼‰                                  â”‚
â”‚       â”‚    â€¢ ç‰¹å¾æ‹¼æ¥ï¼ˆç”¨æˆ·ç‰¹å¾ + ç‰©å“ç‰¹å¾ + ä¸Šä¸‹æ–‡ç‰¹å¾ï¼‰             â”‚
â”‚       â”‚                                                               â”‚
â”‚       â”œâ”€â”€â–º æ¨¡å‹è®­ç»ƒ                                                   â”‚
â”‚       â”‚    â€¢ æ’åºæ¨¡å‹ï¼šLightGBMã€DeepFMã€Wide&Deep                   â”‚
â”‚       â”‚    â€¢ å¬å›æ¨¡å‹ï¼šåŒå¡”æ¨¡å‹ã€DSSM                                 â”‚
â”‚       â”‚    â€¢ CTRé¢„ä¼°æ¨¡å‹ï¼šxDeepFMã€DCN                                â”‚
â”‚       â”‚    â€¢ è®­ç»ƒé›†/éªŒè¯é›†/æµ‹è¯•é›†åˆ†å‰²                                  â”‚
â”‚       â”‚    â€¢ è¶…å‚æ•°è°ƒä¼˜ï¼ˆGridSearch/Bayesianï¼‰                       â”‚
â”‚       â”‚                                                               â”‚
â”‚       â”œâ”€â”€â–º æ¨¡å‹è¯„ä¼°                                                   â”‚
â”‚       â”‚    â€¢ ç¦»çº¿æŒ‡æ ‡ï¼šAUCã€Precisionã€Recallã€NDCG                  â”‚
â”‚       â”‚    â€¢ ä¸šåŠ¡æŒ‡æ ‡ï¼šCTRã€è½¬åŒ–ç‡ã€ç•™å­˜ç‡                             â”‚
â”‚       â”‚    â€¢ A/Bæµ‹è¯•å‡†å¤‡                                              â”‚
â”‚       â”‚                                                               â”‚
â”‚       â””â”€â”€â–º æ¨¡å‹éƒ¨ç½²                                                   â”‚
â”‚            â€¢ ä¿å­˜æ¨¡å‹æ–‡ä»¶ï¼ˆpkl/onnxï¼‰                                 â”‚
â”‚            â€¢ ä¸Šä¼ æ¨¡å‹ä»“åº“                                              â”‚
â”‚            â€¢ æ›´æ–°æ¨¡å‹é…ç½®ï¼ˆMongoDB modelsè¡¨ï¼‰                         â”‚
â”‚            â€¢ é€šçŸ¥æ¨èæœåŠ¡çƒ­æ›´æ–°                                        â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       9ï¸âƒ£ æ¨èæœåŠ¡ï¼ˆåœ¨çº¿ï¼‰                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  RecommendService                                                    â”‚
â”‚       â”‚                                                               â”‚
â”‚       â”œâ”€â”€â–º ç”¨æˆ·è¯·æ±‚æ¨è                                               â”‚
â”‚       â”‚    â€¢ è·å–ç”¨æˆ·ç”»åƒï¼ˆRedis/MongoDBï¼‰                            â”‚
â”‚       â”‚    â€¢ è·å–ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆæ—¶é—´ã€åœ°ç†ä½ç½®ã€è®¾å¤‡ï¼‰                    â”‚
â”‚       â”‚                                                               â”‚
â”‚       â”œâ”€â”€â–º å¬å›é˜¶æ®µï¼ˆRecallï¼‰                                        â”‚
â”‚       â”‚    â€¢ å¤šè·¯å¬å›ï¼ˆæ­¥éª¤7ï¸âƒ£ï¼‰                                       â”‚
â”‚       â”‚    â€¢ å¬å›å€™é€‰é›†åˆå¹¶å»é‡                                        â”‚
â”‚       â”‚    â€¢ å€™é€‰é›†: ~300ä¸ªç‰©å“                                        â”‚
â”‚       â”‚                                                               â”‚
â”‚       â”œâ”€â”€â–º ç²—æ’é˜¶æ®µï¼ˆCoarse Rankingï¼‰                                â”‚
â”‚       â”‚    â€¢ ç®€å•è§„åˆ™è¿‡æ»¤ï¼ˆå·²çœ‹è¿‡ã€è¿è§„å†…å®¹ï¼‰                          â”‚
â”‚       â”‚    â€¢ å¿«é€Ÿæ‰“åˆ†ï¼ˆç®€å•æ¨¡å‹ã€ç‰¹å¾å°‘ï¼‰                              â”‚
â”‚       â”‚    â€¢ ç­›é€‰Top100                                               â”‚
â”‚       â”‚                                                               â”‚
â”‚       â”œâ”€â”€â–º ç²¾æ’é˜¶æ®µï¼ˆFine Rankingï¼‰                                  â”‚
â”‚       â”‚    â€¢ åŠ è½½ç²¾æ’æ¨¡å‹ï¼ˆLightGBM/DeepFMï¼‰                          â”‚
â”‚       â”‚    â€¢ è¯¦ç»†ç‰¹å¾è®¡ç®—                                              â”‚
â”‚       â”‚    â€¢ é¢„ä¼°CTR/è½¬åŒ–ç‡                                            â”‚
â”‚       â”‚    â€¢ æ’åºTopNï¼ˆN=20-50ï¼‰                                      â”‚
â”‚       â”‚                                                               â”‚
â”‚       â”œâ”€â”€â–º é‡æ’é˜¶æ®µï¼ˆRe-Rankingï¼‰                                    â”‚
â”‚       â”‚    â€¢ å¤šæ ·æ€§è°ƒæ•´ï¼ˆé¿å…åŒç±»ç‰©å“å †ç§¯ï¼‰                            â”‚
â”‚       â”‚    â€¢ ä¸šåŠ¡è§„åˆ™ï¼ˆæ–°ç‰©å“æ’å…¥ã€å¹¿å‘Šä½ï¼‰                            â”‚
â”‚       â”‚    â€¢ ABå®éªŒåˆ†æµ                                               â”‚
â”‚       â”‚    â€¢ æœ€ç»ˆç»“æœï¼šTop20                                          â”‚
â”‚       â”‚                                                               â”‚
â”‚       â””â”€â”€â–º è¿”å›æ¨èç»“æœ                                               â”‚
â”‚            â€¢ ç‰©å“è¯¦æƒ…ï¼ˆä»MongoDB/Redisè·å–ï¼‰                          â”‚
â”‚            â€¢ æ¨èç†ç”±ï¼ˆæ ‡ç­¾ã€ç›¸ä¼¼ç‰©å“ï¼‰                                â”‚
â”‚            â€¢ åŸ‹ç‚¹å‚æ•°ï¼ˆç”¨äºåç»­è¡Œä¸ºè¿½è¸ªï¼‰                              â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ğŸ”Ÿ æ•ˆæœç›‘æ§ä¸è¿­ä»£                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”œâ”€â”€â–º è¡Œä¸ºæ•°æ®é‡‡é›†ï¼ˆBehavior Trackingï¼‰                              â”‚
â”‚  â”‚    â€¢ æ›å…‰ã€ç‚¹å‡»ã€åœç•™ã€è½¬åŒ–                                        â”‚
â”‚  â”‚    â€¢ Kafka â†’ Flink â†’ ClickHouse                                  â”‚
â”‚  â”‚                                                                   â”‚
â”‚  â”œâ”€â”€â–º å®æ—¶æŒ‡æ ‡ç›‘æ§ï¼ˆReal-time Monitoringï¼‰                           â”‚
â”‚  â”‚    â€¢ CTRã€è½¬åŒ–ç‡ã€åœç•™æ—¶é•¿                                         â”‚
â”‚  â”‚    â€¢ Grafanaå¤§ç›˜å±•ç¤º                                              â”‚
â”‚  â”‚    â€¢ å¼‚å¸¸å‘Šè­¦                                                      â”‚
â”‚  â”‚                                                                   â”‚
â”‚  â”œâ”€â”€â–º A/Bæµ‹è¯•åˆ†æï¼ˆExperiment Analysisï¼‰                             â”‚
â”‚  â”‚    â€¢ å¯¹æ¯”å®éªŒç»„/å¯¹ç…§ç»„æŒ‡æ ‡                                         â”‚
â”‚  â”‚    â€¢ ç»Ÿè®¡æ˜¾è‘—æ€§æ£€éªŒ                                                â”‚
â”‚  â”‚    â€¢ å†³ç­–æ˜¯å¦å…¨é‡                                                  â”‚
â”‚  â”‚                                                                   â”‚
â”‚  â””â”€â”€â–º æ¨¡å‹è¿­ä»£ä¼˜åŒ–ï¼ˆModel Iterationï¼‰                                â”‚
â”‚       â€¢ åˆ†æbadcaseï¼ˆç‚¹å‡»ç‡ä½çš„æ¨èï¼‰                                 â”‚
â”‚       â€¢ ç‰¹å¾å·¥ç¨‹ä¼˜åŒ–                                                   â”‚
â”‚       â€¢ æ¨¡å‹ç»“æ„è°ƒæ•´                                                   â”‚
â”‚       â€¢ é‡æ–°è®­ç»ƒéƒ¨ç½²                                                   â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®æ€§èƒ½æŒ‡æ ‡

| ç¯èŠ‚ | å»¶è¿Ÿ | åå | è¯´æ˜ |
|-----|------|------|------|
| **ç‰©å“æ¥å…¥ï¼ˆAPIï¼‰** | 100ms | 5K TPS | åŒæ­¥å†™MongoDB + å¼‚æ­¥å‘Kafka |
| **ç‰©å“æ¥å…¥ï¼ˆKafkaï¼‰** | 10ms | 50K TPS | ç›´æ¥å†™Kafkaï¼Œæ¶ˆè´¹è€…æ‰¹é‡å¤„ç† |
| **å‘é‡ç”Ÿæˆ** | 500ms/ç‰©å“ | æ‰¹é‡å¤„ç† | è°ƒç”¨Embeddingæ¨¡å‹ï¼ˆå¯ä½¿ç”¨GPUåŠ é€Ÿï¼‰ |
| **ç´¢å¼•æ„å»º** | ç§’çº§ | - | Milvusè‡ªåŠ¨æ„å»ºï¼Œå¢é‡æ›´æ–° |
| **æ¨èå¬å›** | 50ms | 10K QPS | å¤šè·¯å¹¶è¡Œå¬å› |
| **æ¨¡å‹è®­ç»ƒ** | å°æ—¶çº§ | - | æ¯å¤©/æ¯å‘¨ç¦»çº¿è®­ç»ƒ |
| **åœ¨çº¿æ¨è** | 100ms | 10K QPS | å¬å›â†’ç²—æ’â†’ç²¾æ’â†’é‡æ’ |

---

## æ–¹å¼1ï¼šAPIæ¨é€ï¼ˆæ¨èâœ…ï¼‰

### é€‚ç”¨åœºæ™¯

- vlogå‘å¸ƒåç«‹å³æ¨è
- æ–°é—»å‘å¸ƒåå®æ—¶å±•ç¤º
- ä¸­å°è§„æ¨¡æ•°æ®é‡ï¼ˆ< 10ä¸‡/å¤©ï¼‰
- ä¸šåŠ¡ç³»ç»Ÿæ”¯æŒHTTPè°ƒç”¨

### æ¥å…¥æ­¥éª¤

#### 1. è·å–APIå‡­è¯

- **ç§Ÿæˆ·ID**: `tenant_id`ï¼ˆç”±æ¨èç³»ç»Ÿåˆ†é…ï¼‰
- **APIåœ°å€**: `http://recommender-api:8080/api/v1`

#### 2. è°ƒç”¨æ‰¹é‡å¯¼å…¥æ¥å£

**æ¥å£åœ°å€**:
```
POST /api/v1/items/batch
```

**è¯·æ±‚å¤´**:
```http
Content-Type: application/json
X-Tenant-Id: your_tenant_id
X-User-Id: system
```

**è¯·æ±‚ä½“**:
```json
{
  "scenario_id": "vlog_main_feed",
  "items": [
    {
      "item_id": "vlog_20241022_001",
      "metadata": {
        "title": "åŒ—äº¬æ—…è¡ŒVlog",
        "author": "æ—…è¡Œåšä¸»",
        "author_id": "user_123",
        "duration": 180,
        "cover_url": "https://cdn.example.com/cover.jpg",
        "video_url": "https://cdn.example.com/video.mp4",
        "tags": ["æ—…è¡Œ", "åŒ—äº¬", "ç¾é£Ÿ"],
        "category": "travel",
        "publish_time": "2024-10-22T10:00:00Z"
      }
    },
    {
      "item_id": "vlog_20241022_002",
      "metadata": {
        "title": "ä¸Šæµ·ç¾é£Ÿæ¢åº—",
        "author": "ç¾é£Ÿè¾¾äºº",
        "duration": 240,
        "tags": ["ç¾é£Ÿ", "ä¸Šæµ·"]
      }
    }
  ]
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "æˆåŠŸåˆ›å»º2ä¸ªç‰©å“ï¼Œåç»­å¤„ç†å·²å¯åŠ¨",
  "data": {
    "count": 2,
    "processing": {
      "processed": 2,
      "source": "api",
      "tasks": {
        "kafka_sent": 2,
        "vector_queued": 2,
        "cache_updated": true
      },
      "timestamp": "2024-10-22T10:00:00.000Z"
    }
  }
}
```

#### 3. åç»­å¤„ç†ï¼ˆè‡ªåŠ¨ï¼‰

æ¥å£è°ƒç”¨æˆåŠŸåï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
1. âœ… å†™å…¥MongoDB
2. âœ… å‘é€Kafkaäº‹ä»¶ï¼ˆé€šçŸ¥ä¸‹æ¸¸ï¼‰
3. âœ… è§¦å‘å‘é‡ç”Ÿæˆï¼ˆç”¨äºç›¸ä¼¼æ¨èï¼‰
4. âœ… å¤±æ•ˆç›¸å…³ç¼“å­˜

#### 4. ç¤ºä¾‹ä»£ç 

**Python**:
```python
import requests

def publish_vlog_to_recommender(vlog_data):
    """vlogå‘å¸ƒåè°ƒç”¨æ¨èç³»ç»Ÿ"""
    
    url = "http://recommender-api:8080/api/v1/items/batch"
    headers = {
        "Content-Type": "application/json",
        "X-Tenant-Id": "vlog_platform",
        "X-User-Id": "system"
    }
    
    payload = {
        "scenario_id": "vlog_main_feed",
        "items": [
            {
                "item_id": vlog_data["id"],
                "metadata": {
                    "title": vlog_data["title"],
                    "author": vlog_data["author"],
                    "duration": vlog_data["duration"],
                    "cover_url": vlog_data["cover_url"],
                    "tags": vlog_data["tags"]
                }
            }
        ]
    }
    
    response = requests.post(url, json=payload, headers=headers)
    
    if response.status_code == 200:
        result = response.json()
        print(f"âœ… æ¨èç³»ç»Ÿæ¥å…¥æˆåŠŸ: {result}")
    else:
        print(f"âŒ æ¨èç³»ç»Ÿæ¥å…¥å¤±è´¥: {response.text}")
```

**Go**:
```go
func publishVlogToRecommender(vlog VlogData) error {
    url := "http://recommender-api:8080/api/v1/items/batch"
    
    payload := map[string]interface{}{
        "scenario_id": "vlog_main_feed",
        "items": []map[string]interface{}{
            {
                "item_id": vlog.ID,
                "metadata": map[string]interface{}{
                    "title":  vlog.Title,
                    "author": vlog.Author,
                    "tags":   vlog.Tags,
                },
            },
        },
    }
    
    body, _ := json.Marshal(payload)
    req, _ := http.NewRequest("POST", url, bytes.NewBuffer(body))
    req.Header.Set("Content-Type", "application/json")
    req.Header.Set("X-Tenant-Id", "vlog_platform")
    req.Header.Set("X-User-Id", "system")
    
    client := &http.Client{Timeout: 10 * time.Second}
    resp, err := client.Do(req)
    
    if err != nil {
        return err
    }
    defer resp.Body.Close()
    
    if resp.StatusCode == 200 {
        fmt.Println("âœ… æ¨èç³»ç»Ÿæ¥å…¥æˆåŠŸ")
        return nil
    }
    
    return fmt.Errorf("æ¨èç³»ç»Ÿæ¥å…¥å¤±è´¥: %d", resp.StatusCode)
}
```

---

## æ–¹å¼2ï¼šKafkaæ¶ˆè´¹

### é€‚ç”¨åœºæ™¯

- å¤§è§„æ¨¡æ•°æ®æ¥å…¥ï¼ˆ> 10ä¸‡/å¤©ï¼‰
- å·²æœ‰KafkaåŸºç¡€è®¾æ–½
- éœ€è¦å‰Šå³°å¡«è°·
- éœ€è¦å¼‚æ­¥è§£è€¦

### æ¥å…¥æ­¥éª¤

#### 1. å‘é€æ¶ˆæ¯åˆ°Kafka

ä¸šåŠ¡ç³»ç»Ÿå°†ç‰©å“æ•°æ®å‘é€åˆ°æŒ‡å®šTopicã€‚

**Topicå‘½åè§„èŒƒ**:
- `items-ingest` - ç»Ÿä¸€æ¥å…¥Topicï¼ˆæ¨èï¼‰
- `vlog-items` - vlogä¸“ç”¨Topic
- `news-items` - æ–°é—»ä¸“ç”¨Topic
- `{ä¸šåŠ¡}-items` - è‡ªå®šä¹‰Topicï¼ˆéœ€é…ç½®ï¼‰

**æ¶ˆæ¯æ ¼å¼**:
```json
{
  "tenant_id": "vlog_platform",
  "scenario_id": "vlog_main_feed",
  "items": [
    {
      "item_id": "vlog_20241022_001",
      "metadata": {
        "title": "åŒ—äº¬æ—…è¡ŒVlog",
        "author": "æ—…è¡Œåšä¸»",
        "duration": 180,
        "tags": ["æ—…è¡Œ", "åŒ—äº¬"]
      }
    }
  ]
}
```

**æ¶ˆæ¯Key**ï¼ˆå¯é€‰ï¼‰:
- ä½¿ç”¨ `tenant_id` ä½œä¸ºkeyï¼Œç¡®ä¿åŒä¸€ç§Ÿæˆ·çš„æ¶ˆæ¯æœ‰åº

#### 2. å¯åŠ¨Kafkaæ¶ˆè´¹è€…ï¼ˆæ¨èç³»ç»Ÿä¾§ï¼‰

æ¨èç³»ç»Ÿæä¾›å®ˆæŠ¤è¿›ç¨‹æ¶ˆè´¹Kafkaæ¶ˆæ¯ã€‚

```bash
# åå°å¯åŠ¨
nohup poetry run python scripts/run_item_consumer.py > logs/item_consumer.log 2>&1 &

# æˆ–ä½¿ç”¨systemd
systemctl start recommender-item-consumer
```

#### 3. ç›‘æ§æ¶ˆè´¹çŠ¶æ€

æŸ¥çœ‹æ—¥å¿—ï¼š
```bash
tail -f logs/item_consumer.log
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
[ItemKafkaConsumer] æ”¶åˆ°æ¶ˆæ¯: Topic=vlog-items, Tenant=vlog_platform, Scenario=vlog_main_feed, Items=10
[ItemKafkaConsumer] âœ… å†™å…¥MongoDB: 10ä¸ªç‰©å“
[ItemKafkaConsumer] âœ… å¤„ç†å®Œæˆ: {'processed': 10, 'source': 'kafka', ...}
```

#### 4. ç¤ºä¾‹ä»£ç 

**Python (ä½¿ç”¨aiokafka)**:
```python
from aiokafka import AIOKafkaProducer
import json

async def send_vlogs_to_kafka():
    producer = AIOKafkaProducer(
        bootstrap_servers='localhost:9092',
        value_serializer=lambda v: json.dumps(v).encode('utf-8')
    )
    
    await producer.start()
    
    message = {
        "tenant_id": "vlog_platform",
        "scenario_id": "vlog_main_feed",
        "items": [
            {
                "item_id": "vlog_001",
                "metadata": {"title": "æ—…è¡ŒVlog"}
            }
        ]
    }
    
    await producer.send('items-ingest', value=message, key=b'vlog_platform')
    await producer.stop()
```

**Go (ä½¿ç”¨sarama)**:
```go
func sendVlogsToKafka(vlogs []Vlog) error {
    config := sarama.NewConfig()
    config.Producer.Return.Successes = true
    
    producer, err := sarama.NewSyncProducer([]string{"localhost:9092"}, config)
    if err != nil {
        return err
    }
    defer producer.Close()
    
    message := map[string]interface{}{
        "tenant_id":   "vlog_platform",
        "scenario_id": "vlog_main_feed",
        "items":       vlogs,
    }
    
    msgBytes, _ := json.Marshal(message)
    
    _, _, err = producer.SendMessage(&sarama.ProducerMessage{
        Topic: "items-ingest",
        Key:   sarama.StringEncoder("vlog_platform"),
        Value: sarama.ByteEncoder(msgBytes),
    })
    
    return err
}
```

---

## ğŸ“Š ä¸¤ç§æ–¹å¼å¯¹æ¯”

| ç‰¹æ€§ | APIæ¨é€ | Kafkaæ¶ˆè´¹ |
|------|--------|----------|
| **å»¶è¿Ÿ** | ç§’çº§ | ç§’çº§ |
| **ååé‡** | ä¸­ç­‰ | æé«˜ |
| **å¯é æ€§** | åŒæ­¥ç¡®è®¤ | å¼‚æ­¥æŒä¹…åŒ– |
| **å®ç°å¤æ‚åº¦** | â­ ç®€å• | â­â­ ä¸­ç­‰ |
| **ä¾èµ–ç»„ä»¶** | æ—  | Kafkaé›†ç¾¤ |
| **é€‚åˆè§„æ¨¡** | < 10ä¸‡/å¤© | > 10ä¸‡/å¤© |
| **å‰Šå³°å¡«è°·** | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| **æ¶ˆæ¯å›æº¯** | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |

---

## ğŸš€ æœ€ä½³å®è·µ

### 1. æ¥å…¥æ–¹å¼é€‰æ‹©

**æ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©æ¥å…¥æ–¹å¼**ï¼š

| ä¸šåŠ¡åœºæ™¯ | æ¨èæ–¹å¼ | ç†ç”± |
|---------|---------|------|
| å†…å®¹å®æ—¶å‘å¸ƒï¼ˆvlogã€æ–‡ç« ï¼‰ | **APIæ¨é€** | ä½å»¶è¿Ÿã€åŒæ­¥ç¡®è®¤ã€ä¿è¯å®æ—¶æ€§ |
| å•†å“æ‰¹é‡å¯¼å…¥ | **Kafkaæ¶ˆè´¹** | é«˜ååã€å‰Šå³°å¡«è°· |
| å†å²æ•°æ®è¿ç§» | **Kafkaæ¶ˆè´¹** | æ‰¹é‡å¤„ç†ã€ä¸å½±å“åœ¨çº¿æœåŠ¡ |
| å®šæ—¶æ•°æ®åŒæ­¥ | **Kafkaæ¶ˆè´¹** | å¼‚æ­¥è§£è€¦ã€å¯é æ€§é«˜ |

**æ··åˆä½¿ç”¨ç­–ç•¥**ï¼š
- **å®æ—¶å‘å¸ƒ**ï¼šä½¿ç”¨APIæ¨é€ï¼ˆä½å»¶è¿Ÿã€ä¿è¯æ•°æ®å³æ—¶å¯ç”¨ï¼‰
- **æ‰¹é‡å¯¼å…¥**ï¼šä½¿ç”¨Kafkaæ¶ˆè´¹ï¼ˆé«˜ååã€ç³»ç»Ÿè§£è€¦ï¼‰
- **ç´§æ€¥ä¿®å¤**ï¼šä½¿ç”¨APIæ¨é€ï¼ˆç«‹å³ç”Ÿæ•ˆï¼‰

### 2. åœºæ™¯åŒ–æ•°æ®è®¾è®¡

**ä¸åŒåœºæ™¯åŒ…å«ä¸åŒçš„æ ¸å¿ƒå­—æ®µ**ï¼š

#### è§†é¢‘åœºæ™¯å¿…å¡«/æ¨èå­—æ®µ
```python
{
  "item_id": "å¿…å¡«",
  "metadata": {
    "title": "å¿…å¡« - ç”¨äºå‘é‡ã€æœç´¢",
    "video_url": "å¿…å¡« - æ’­æ”¾åœ°å€",
    "duration": "å¿…å¡« - å½±å“æ¨èç­–ç•¥",
    "author_id": "å¼ºçƒˆæ¨è - ç”¨äºä½œè€…å¬å›",
    "cover_url": "å¼ºçƒˆæ¨è - å‰ç«¯å±•ç¤º",
    "tags": "å¼ºçƒˆæ¨è - æ ‡ç­¾å¬å›",
    "category": "æ¨è - åˆ†ç±»è¿‡æ»¤",
    "publish_time": "æ¨è - æ—¶é—´è¡°å‡ã€å†·å¯åŠ¨",
    
    # ä»¥ä¸‹å­—æ®µå¯ç”±è¡Œä¸ºæ•°æ®å®æ—¶è®¡ç®—ï¼Œæ— éœ€æ¯æ¬¡æ›´æ–°
    "view_count": "å¯é€‰",
    "like_count": "å¯é€‰",
    "completion_rate": "å¯é€‰"
  }
}
```

#### ç”µå•†åœºæ™¯å¿…å¡«/æ¨èå­—æ®µ
```python
{
  "item_id": "å¿…å¡«",
  "metadata": {
    "title": "å¿…å¡« - å•†å“åç§°",
    "price": "å¿…å¡« - å½±å“æ’åº",
    "stock": "å¿…å¡« - è¿‡æ»¤å”®ç½„å•†å“",
    "brand": "å¼ºçƒˆæ¨è - å“ç‰Œå¬å›",
    "category": "å¼ºçƒˆæ¨è - åˆ†ç±»å¬å›",
    "tags": "æ¨è - æ ‡ç­¾å¬å›",
    "cover_url": "æ¨è - å‰ç«¯å±•ç¤º",
    "description": "æ¨è - å‘é‡ç”Ÿæˆ",
    
    # ä»¥ä¸‹å­—æ®µå½±å“è½¬åŒ–ç‡é¢„ä¼°
    "rating": "æ¨è",
    "sales_count": "æ¨è",
    "discount": "æ¨è"
  }
}
```

#### æ–°é—»/èµ„è®¯åœºæ™¯å¿…å¡«/æ¨èå­—æ®µ
```python
{
  "item_id": "å¿…å¡«",
  "metadata": {
    "title": "å¿…å¡« - æ ‡é¢˜æ˜¯æ ¸å¿ƒ",
    "content": "å¿…å¡« - å…¨æ–‡ç”¨äºå‘é‡",
    "summary": "å¼ºçƒˆæ¨è - æ‘˜è¦å±•ç¤º",
    "category": "å¼ºçƒˆæ¨è - åˆ†ç±»å¬å›",
    "tags": "å¼ºçƒˆæ¨è - å…´è¶£åŒ¹é…",
    "publish_time": "å¿…å¡« - æ–°é—»æ—¶æ•ˆæ€§",
    "author_id": "æ¨è - åª’ä½“/ä½œè€…å¬å›",
    "keywords": "æ¨è - å…³é”®è¯åŒ¹é…"
  }
}
```

#### éŸ³ä¹åœºæ™¯å¿…å¡«/æ¨èå­—æ®µ
```python
{
  "item_id": "å¿…å¡«",
  "metadata": {
    "title": "å¿…å¡« - æ­Œæ›²å",
    "artist": "å¿…å¡« - æ­Œæ‰‹åï¼ˆæ ¸å¿ƒç‰¹å¾ï¼‰",
    "audio_url": "å¿…å¡« - æ’­æ”¾åœ°å€",
    "duration": "å¿…å¡« - å½±å“æ¨è",
    "genre": "å¼ºçƒˆæ¨è - æ›²é£å¬å›",
    "mood": "æ¨è - æƒ…ç»ªæ¨è",
    "album": "æ¨è - ä¸“è¾‘æ¨è",
    "tags": "æ¨è - æ ‡ç­¾å¬å›"
  }
}
```

#### æ•™è‚²åœºæ™¯å¿…å¡«/æ¨èå­—æ®µ
```python
{
  "item_id": "å¿…å¡«",
  "metadata": {
    "title": "å¿…å¡« - è¯¾ç¨‹åç§°",
    "instructor": "å¿…å¡« - è®²å¸ˆï¼ˆæ ¸å¿ƒç‰¹å¾ï¼‰",
    "difficulty": "å¿…å¡« - éš¾åº¦åŒ¹é…",
    "category": "å¼ºçƒˆæ¨è - åˆ†ç±»å¬å›",
    "price": "æ¨è - ä»·æ ¼è¿‡æ»¤",
    "duration": "æ¨è - æ—¶é•¿åŒ¹é…",
    "tags": "æ¨è - æŠ€èƒ½æ ‡ç­¾",
    "rating": "æ¨è - è´¨é‡è¯„ä¼°"
  }
}
```

#### å†…å®¹æ¨èåœºæ™¯å¿…å¡«/æ¨èå­—æ®µ
```python
{
  "item_id": "å¿…å¡«",
  "metadata": {
    "title": "å¿…å¡« - å†…å®¹æ ‡é¢˜",
    "content_type": "å¿…å¡« - å†…å®¹ç±»å‹ï¼ˆpost/question/answerï¼‰",
    "author_id": "å¿…å¡« - ä½œè€…ID",
    "topic": "å¼ºçƒˆæ¨è - è¯é¢˜åˆ†ç±»",
    "word_count": "æ¨è - å†…å®¹é•¿åº¦",
    "tags": "æ¨è - æ ‡ç­¾å¬å›",
    "content_quality_score": "æ¨è - è´¨é‡è¿‡æ»¤",
    "is_original": "æ¨è - åŸåˆ›å†…å®¹æ ‡è¯†"
  }
}
```

#### ç¤¾äº¤æ¨èåœºæ™¯å¿…å¡«/æ¨èå­—æ®µ
```python
{
  "item_id": "å¿…å¡« - ç”¨æˆ·ID",
  "metadata": {
    "title": "å¿…å¡« - ç”¨æˆ·åç§°/æ˜µç§°",
    "user_profile": "å¿…å¡« - ç”¨æˆ·åŸºæœ¬ä¿¡æ¯",
    "follower_count": "å¼ºçƒˆæ¨è - å½±å“åŠ›æŒ‡æ ‡",
    "influence_score": "å¼ºçƒˆæ¨è - å½±å“åŠ›åˆ†æ•°",
    "interests": "å¼ºçƒˆæ¨è - å…´è¶£åŒ¹é…",
    "relationship_type": "æ¨è - å…³ç³»ç±»å‹",
    "is_verified": "æ¨è - è®¤è¯æ ‡è¯†",
    "mutual_friends_count": "æ¨è - ç¤¾äº¤è·ç¦»"
  }
}
```

#### ä¸ªæ€§åŒ–æ¨èåœºæ™¯å¿…å¡«/æ¨èå­—æ®µ
```python
{
  "item_id": "å¿…å¡«",
  "metadata": {
    "title": "å¿…å¡« - å†…å®¹æ ‡é¢˜",
    "personalization_score": "å¿…å¡« - ä¸ªæ€§åŒ–åˆ†æ•°",
    "match_reasons": "å¼ºçƒˆæ¨è - æ¨èç†ç”±",
    "recommendation_strategy": "å¼ºçƒˆæ¨è - æ¨èç­–ç•¥",
    "source_item_id": "å¿…å¡« - æºç‰©å“ID",
    "source_item_type": "å¿…å¡« - æºç‰©å“ç±»å‹",
    "predicted_ctr": "æ¨è - é¢„æµ‹ç‚¹å‡»ç‡",
    "diversity_group": "æ¨è - å¤šæ ·æ€§æ§åˆ¶"
  }
}
```

### 3. æ•°æ®è´¨é‡ä¿è¯

#### å­—æ®µéªŒè¯
```python
# Pythonç¤ºä¾‹ï¼šå‘é€å‰éªŒè¯
def validate_item_data(item: dict, scenario: str) -> bool:
    """éªŒè¯ç‰©å“æ•°æ®"""
    
    # é€šç”¨å¿…å¡«å­—æ®µ
    if not item.get("item_id"):
        raise ValueError("item_idæ˜¯å¿…å¡«å­—æ®µ")
    
    metadata = item.get("metadata", {})
    
    # åœºæ™¯ç‰¹å®šéªŒè¯
    if scenario == "video":
        required = ["title", "video_url", "duration"]
        for field in required:
            if not metadata.get(field):
                raise ValueError(f"è§†é¢‘åœºæ™¯å¿…é¡»åŒ…å«{field}å­—æ®µ")
    
    elif scenario == "ecommerce":
        required = ["title", "price", "stock"]
        for field in required:
            if not metadata.get(field):
                raise ValueError(f"ç”µå•†åœºæ™¯å¿…é¡»åŒ…å«{field}å­—æ®µ")
        
        # ä»·æ ¼æ ¡éªŒ
        if metadata["price"] < 0:
            raise ValueError("ä»·æ ¼ä¸èƒ½ä¸ºè´Ÿæ•°")
    
    return True
```

#### æ•°æ®æ¸…æ´—
- **å»é™¤HTMLæ ‡ç­¾**ï¼š`title`å’Œ`description`ä¸­çš„HTMLéœ€è¦æ¸…ç†
- **ç»Ÿä¸€æ—¶é—´æ ¼å¼**ï¼šä½¿ç”¨ISO8601æ ¼å¼ï¼ˆ`2024-10-30T10:00:00Z`ï¼‰
- **æ ‡ç­¾æ ‡å‡†åŒ–**ï¼šç»Ÿä¸€å¤§å°å†™ã€å»é‡ã€é™åˆ¶æ•°é‡ï¼ˆå»ºè®®5-10ä¸ªï¼‰
- **æ–‡æœ¬é•¿åº¦é™åˆ¶**ï¼š
  - `title`: 1-200å­—ç¬¦
  - `description`: 1-5000å­—ç¬¦
  - `tags`: æ¯ä¸ªæ ‡ç­¾2-20å­—ç¬¦

### 4. æ€§èƒ½ä¼˜åŒ–

#### æ‰¹é‡æäº¤
**æ¨èåšæ³•** âœ…ï¼š
```python
# æ‰¹é‡æäº¤ï¼ˆæ¯æ‰¹100-500ä¸ªç‰©å“ï¼‰
items = [...]  # 500ä¸ªç‰©å“
response = requests.post(
    "http://recommender-api:8080/api/v1/items/batch",
    json={"scenario_id": "vlog_main_feed", "items": items}
)
```

**ä¸æ¨èåšæ³•** âŒï¼š
```python
# é€ä¸ªæäº¤ï¼ˆç½‘ç»œå¼€é”€å¤§ï¼‰
for item in items:
    response = requests.post(...)  # 500æ¬¡ç½‘ç»œè¯·æ±‚
```

#### å¹¶å‘æ§åˆ¶
```python
# ä½¿ç”¨è¿æ¥æ±  + å¹¶å‘
import asyncio
import aiohttp

async def batch_upload_items(items_batches: list):
    """å¹¶å‘ä¸Šä¼ å¤šæ‰¹ç‰©å“"""
    async with aiohttp.ClientSession() as session:
        tasks = [
            upload_batch(session, batch) 
            for batch in items_batches
        ]
        results = await asyncio.gather(*tasks)
    return results
```

#### Kafkaä¼˜åŒ–
```python
# Kafkaæ‰¹é‡å‘é€
from aiokafka import AIOKafkaProducer

producer = AIOKafkaProducer(
    bootstrap_servers='localhost:9092',
    # æ‰¹é‡å‘é€é…ç½®
    linger_ms=100,          # ç­‰å¾…100msç§¯ç´¯æ¶ˆæ¯
    batch_size=16384,       # æ‰¹é‡å¤§å°16KB
    compression_type='lz4'  # å‹ç¼©ï¼ˆå‡å°‘ç½‘ç»œå¼€é”€ï¼‰
)
```

### 5. é”™è¯¯å¤„ç†ä¸é‡è¯•

#### APIæ¨é€é‡è¯•ç­–ç•¥
```python
import time
from typing import Optional

def push_items_with_retry(
    items: list, 
    max_retries: int = 3
) -> Optional[dict]:
    """å¸¦é‡è¯•çš„APIæ¨é€"""
    
    for attempt in range(max_retries):
        try:
            response = requests.post(
                url="http://recommender-api:8080/api/v1/items/batch",
                json={"scenario_id": "vlog_main_feed", "items": items},
                headers={"X-Tenant-Id": "tenant_001"},
                timeout=10  # è¶…æ—¶æ—¶é—´
            )
            
            if response.status_code == 200:
                return response.json()
            elif response.status_code >= 500:
                # æœåŠ¡ç«¯é”™è¯¯ï¼Œå¯é‡è¯•
                wait_time = 2 ** attempt  # æŒ‡æ•°é€€é¿ï¼š2s, 4s, 8s
                time.sleep(wait_time)
                continue
            else:
                # å®¢æˆ·ç«¯é”™è¯¯ï¼ˆ4xxï¼‰ï¼Œä¸é‡è¯•
                print(f"å®¢æˆ·ç«¯é”™è¯¯: {response.status_code}")
                return None
        
        except requests.exceptions.Timeout:
            print(f"è¯·æ±‚è¶…æ—¶ï¼Œé‡è¯• {attempt + 1}/{max_retries}")
            continue
        except Exception as e:
            print(f"æœªçŸ¥é”™è¯¯: {e}")
            return None
    
    print("é‡è¯•æ¬¡æ•°å·²ç”¨å°½")
    return None
```

#### å¤±è´¥æ—¥å¿—è®°å½•
```python
import logging

# è®°å½•å¤±è´¥çš„ç‰©å“ï¼Œä¾¿äºåç»­è¡¥å½•
failed_items_logger = logging.getLogger("failed_items")
failed_items_logger.addHandler(
    logging.FileHandler("failed_items.log")
)

# æ¨é€å¤±è´¥æ—¶è®°å½•
if not result:
    failed_items_logger.error(
        f"ç‰©å“æ¨é€å¤±è´¥: {json.dumps(item)}"
    )
```

### 6. ç›‘æ§ä¸å‘Šè­¦

#### å…³é”®æŒ‡æ ‡ç›‘æ§

| æŒ‡æ ‡ | é˜ˆå€¼ | å‘Šè­¦çº§åˆ« |
|-----|------|---------|
| **APIæˆåŠŸç‡** | > 99.9% | P0ï¼ˆç«‹å³å“åº”ï¼‰ |
| **API P99å»¶è¿Ÿ** | < 200ms | P1ï¼ˆ1å°æ—¶å†…ï¼‰ |
| **Kafkaæ¶ˆè´¹å»¶è¿Ÿ** | < 1ç§’ | P1 |
| **å‘é‡ç”ŸæˆæˆåŠŸç‡** | > 99% | P2ï¼ˆ4å°æ—¶å†…ï¼‰ |
| **ç‰©å“æ¥å…¥é‡** | ç›‘æ§çªå¢/çªé™ | P2 |
| **é‡å¤ç‰©å“ç‡** | < 1% | P3ï¼ˆæ—¥æŠ¥å‘Šï¼‰ |

#### Prometheusç›‘æ§ç¤ºä¾‹
```python
from prometheus_client import Counter, Histogram

# ç‰©å“æ¥å…¥è®¡æ•°
items_ingested = Counter(
    'items_ingested_total',
    'Total items ingested',
    ['tenant_id', 'scenario_id', 'status']
)

# ç‰©å“æ¥å…¥å»¶è¿Ÿ
items_ingest_latency = Histogram(
    'items_ingest_latency_seconds',
    'Item ingest latency',
    ['method']  # api or kafka
)

# è®°å½•æŒ‡æ ‡
items_ingested.labels(
    tenant_id='tenant_001',
    scenario_id='vlog_main_feed',
    status='success'
).inc()
```

### 7. æ•°æ®æ›´æ–°ç­–ç•¥

#### å¢é‡æ›´æ–°
- **æ–°å¢ç‰©å“**ï¼šç›´æ¥è°ƒç”¨æ¥å…¥æ¥å£
- **ä¿®æ”¹ç‰©å“**ï¼šä½¿ç”¨`PUT /api/v1/items/{item_id}`æ›´æ–°
- **åˆ é™¤ç‰©å“**ï¼šä½¿ç”¨`DELETE /api/v1/items/{item_id}`ï¼ˆè½¯åˆ é™¤ï¼Œä¸å½±å“å†å²æ•°æ®ï¼‰

#### å…¨é‡æ›´æ–°
```python
# åœºæ™¯ï¼šæ¯å¤©å‡Œæ™¨å…¨é‡åŒæ­¥å•†å“åº“å­˜/ä»·æ ¼
async def daily_full_sync():
    """å…¨é‡åŒæ­¥ï¼ˆå»ºè®®ä½¿ç”¨Kafkaï¼‰"""
    
    # 1. ä»ä¸šåŠ¡ç³»ç»Ÿè·å–å…¨é‡æ•°æ®
    all_products = fetch_all_products_from_db()
    
    # 2. åˆ†æ‰¹å‘é€åˆ°Kafka
    batch_size = 1000
    for i in range(0, len(all_products), batch_size):
        batch = all_products[i:i + batch_size]
        await send_to_kafka(topic='items-ingest', items=batch)
    
    # 3. æ ‡è®°åˆ é™¤çš„ç‰©å“ï¼ˆä¸åœ¨å…¨é‡æ•°æ®ä¸­çš„ç‰©å“ï¼‰
    await mark_deleted_items(all_products)
```

### 8. å®‰å…¨ä¸æƒé™

#### ç§Ÿæˆ·éš”ç¦»
```python
# è¯·æ±‚å¤´å¿…é¡»åŒ…å«ç§Ÿæˆ·ID
headers = {
    "X-Tenant-Id": "tenant_001",  # å¿…å¡«
    "X-User-Id": "system",         # ç³»ç»Ÿè´¦å·
    "Content-Type": "application/json"
}
```

#### æ•æ„Ÿæ•°æ®å¤„ç†
- **ä¸è¦ä¼ è¾“æ•æ„Ÿä¿¡æ¯**ï¼šå¦‚ç”¨æˆ·éšç§ã€å•†ä¸šæœºå¯†
- **URLåŠ å¯†**ï¼š`video_url`ã€`audio_url`å»ºè®®ä½¿ç”¨CDNç­¾åURL
- **ä»·æ ¼è„±æ•**ï¼ˆå¯é€‰ï¼‰ï¼šä»…ä¼ è¾“ä»·æ ¼åŒºé—´è€Œéç²¾ç¡®ä»·æ ¼

---

## â“ å¸¸è§é—®é¢˜

### Q1: APIæ¨é€å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A**: å®ç°é‡è¯•æœºåˆ¶ã€‚å¦‚æœæŒç»­å¤±è´¥ï¼ŒæŒ‰ä»¥ä¸‹æ­¥éª¤æ’æŸ¥ï¼š

1. **æ£€æŸ¥ç§Ÿæˆ·ID**ï¼š
   ```bash
   # ç¡®è®¤ç§Ÿæˆ·IDæ˜¯å¦æ­£ç¡®
   curl -H "X-Tenant-Id: your_tenant_id" \
     "http://recommender-api:8080/api/v1/scenarios"
   ```

2. **æ£€æŸ¥ç½‘ç»œè¿æ¥**ï¼š
   ```bash
   # æµ‹è¯•è¿é€šæ€§
   curl -v http://recommender-api:8080/health
   ```

3. **æŸ¥çœ‹é”™è¯¯æ—¥å¿—**ï¼š
   - 4xxé”™è¯¯ï¼šæ£€æŸ¥è¯·æ±‚æ•°æ®æ ¼å¼
   - 5xxé”™è¯¯ï¼šè”ç³»æ¨èç³»ç»Ÿå›¢é˜Ÿ
   - è¶…æ—¶ï¼šæ£€æŸ¥ç‰©å“æ•°æ®å¤§å°ï¼ˆå»ºè®®å•æ‰¹ < 500ä¸ªï¼‰

4. **å®ç°é‡è¯•**ï¼šå‚è€ƒ[æœ€ä½³å®è·µ - é”™è¯¯å¤„ç†](#5-é”™è¯¯å¤„ç†ä¸é‡è¯•)

### Q2: Kafkaæ¶ˆæ¯ç§¯å‹æ€ä¹ˆåŠï¼Ÿ

**A**: Kafkaæ¶ˆæ¯ç§¯å‹é€šå¸¸ç”±ä»¥ä¸‹åŸå› å¯¼è‡´ï¼š

**è¯Šæ–­æ­¥éª¤**ï¼š
```bash
# æŸ¥çœ‹æ¶ˆè´¹è€…lag
kafka-consumer-groups --bootstrap-server localhost:9092 \
  --describe --group item-consumer-group

# è¾“å‡ºç¤ºä¾‹ï¼š
# TOPIC           PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG
# items-ingest    0          1000            5000            4000  â† ç§¯å‹4000æ¡
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **æ°´å¹³æ‰©å±•æ¶ˆè´¹è€…**ï¼š
   ```bash
   # å¯åŠ¨æ›´å¤šæ¶ˆè´¹è€…å®ä¾‹
   docker-compose up -d --scale item-consumer=3
   ```

2. **æ£€æŸ¥MongoDBå†™å…¥æ€§èƒ½**ï¼š
   ```python
   # å¯ç”¨æ‰¹é‡å†™å…¥
   await collection.insert_many(documents, ordered=False)
   ```

3. **ä¼˜åŒ–å‘é‡ç”Ÿæˆ**ï¼š
   ```python
   # å¼‚æ­¥å¤„ç†ï¼Œä¸é˜»å¡æ¶ˆè´¹
   asyncio.create_task(generate_embedding(item))
   ```

4. **ä¸´æ—¶æ–¹æ¡ˆ**ï¼šæš‚åœå‘é‡ç”Ÿæˆï¼Œä¼˜å…ˆä¿è¯ç‰©å“å­˜å‚¨

### Q3: å¦‚ä½•ç¡®è®¤æ•°æ®æ¥å…¥æˆåŠŸï¼Ÿ

**A**: ä¸‰ç§éªŒè¯æ–¹å¼ï¼š

#### æ–¹å¼1ï¼šAPIå“åº”éªŒè¯
```python
response = requests.post(...)
result = response.json()

# æ£€æŸ¥processingå­—æ®µ
print(result['data']['processing'])
# è¾“å‡ºï¼š
# {
#   "processed": 10,
#   "source": "api",
#   "tasks": {
#     "kafka_sent": 10,
#     "vector_queued": 10,
#     "cache_updated": true
#   }
# }
```

#### æ–¹å¼2ï¼šæŸ¥è¯¢ç‰©å“æ¥å£
```bash
# æŒ‰item_idæŸ¥è¯¢
curl -H "X-Tenant-Id: tenant_001" \
  "http://recommender-api:8080/api/v1/items/video_001?scenario_id=vlog_main_feed"

# åˆ—è¡¨æŸ¥è¯¢
curl -H "X-Tenant-Id: tenant_001" \
  "http://recommender-api:8080/api/v1/items?scenario_id=vlog_main_feed&page=1&page_size=20"
```

#### æ–¹å¼3ï¼šMongoDBç›´æ¥æŸ¥è¯¢
```javascript
// MongoDB Shell
use recommender;
db.items.findOne({
  "tenant_id": "tenant_001",
  "scenario_id": "vlog_main_feed",
  "item_id": "video_001"
});
```

#### æ–¹å¼4ï¼šæŸ¥çœ‹å‘é‡ç”ŸæˆçŠ¶æ€
```bash
# æ£€æŸ¥æ˜¯å¦ç”Ÿæˆå‘é‡
curl -H "X-Tenant-Id: tenant_001" \
  "http://recommender-api:8080/api/v1/items/video_001" | jq '.embedding'

# è¾“å‡ºï¼š
# [0.123, -0.456, 0.789, ...]  â† å·²ç”Ÿæˆ
# null                          â† æœªç”Ÿæˆï¼ˆæ­£åœ¨é˜Ÿåˆ—ä¸­ï¼‰
```

### Q4: å¦‚ä½•æ–°å¢è‡ªå®šä¹‰Topicï¼Ÿ

**A**: ä¿®æ”¹é…ç½®æ–‡ä»¶å¹¶é‡å¯æ¶ˆè´¹è€…ï¼š

```bash
# 1. ä¿®æ”¹é…ç½®
# config/prod.env
KAFKA_ITEM_INGEST_TOPICS=items-ingest,vlog-items,news-items,your-custom-topic

# 2. åˆ›å»ºTopicï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
kafka-topics --create \
  --bootstrap-server localhost:9092 \
  --topic your-custom-topic \
  --partitions 12 \
  --replication-factor 3

# 3. é‡å¯æ¶ˆè´¹è€…
docker-compose restart item-consumer
```

### Q5: ä¸åŒåœºæ™¯çš„ç‰©å“å¯ä»¥å…±å­˜å—ï¼Ÿ

**A**: å¯ä»¥ã€‚æ¨èç³»ç»Ÿæ”¯æŒå¤šåœºæ™¯ã€å¤šç§Ÿæˆ·æ¶æ„ï¼š

```python
# åŒä¸€ç§Ÿæˆ·ä¸‹çš„ä¸åŒåœºæ™¯
{
  "tenant_id": "media_platform",
  "scenario_id": "vlog_feed",      # vlogåœºæ™¯
  "items": [...]
}

{
  "tenant_id": "media_platform",
  "scenario_id": "news_feed",      # æ–°é—»åœºæ™¯
  "items": [...]
}

# ä¸åŒåœºæ™¯çš„ç‰©å“å®Œå…¨éš”ç¦»ï¼Œäº’ä¸å½±å“
```

**æ³¨æ„äº‹é¡¹**ï¼š
- æ¯ä¸ªåœºæ™¯ç‹¬ç«‹ç®¡ç†ç‰©å“
- `item_id`åœ¨**åŒä¸€åœºæ™¯å†…**å¿…é¡»å”¯ä¸€
- ä¸åŒåœºæ™¯çš„`item_id`å¯ä»¥é‡å¤ï¼ˆé€šè¿‡`scenario_id`åŒºåˆ†ï¼‰
- æ¨èç»“æœä»…è¿”å›å½“å‰åœºæ™¯çš„ç‰©å“

### Q6: å¦‚ä½•å¤„ç†å¤§æ–‡æœ¬å­—æ®µï¼ˆå¦‚æ–°é—»å…¨æ–‡ï¼‰ï¼Ÿ

**A**: é’ˆå¯¹å¤§æ–‡æœ¬å­—æ®µï¼ˆå¦‚æ–°é—»`content`ã€å•†å“`description`ï¼‰ï¼Œæœ‰ä¸¤ç§ç­–ç•¥ï¼š

#### ç­–ç•¥1ï¼šç›´æ¥å­˜å‚¨ï¼ˆæ¨èï¼‰
```json
{
  "item_id": "article_001",
  "metadata": {
    "title": "æ ‡é¢˜",
    "content": "å®Œæ•´æ–‡ç« å†…å®¹ï¼ˆå¯èƒ½å¾ˆé•¿ï¼‰...",  // ç›´æ¥å­˜å‚¨
    "summary": "æ‘˜è¦ï¼ˆç”¨äºå‰ç«¯å±•ç¤ºï¼‰"
  }
}
```
- **ä¼˜ç‚¹**ï¼šå‘é‡ç”Ÿæˆè´¨é‡é«˜ã€è¯­ä¹‰ç†è§£å‡†ç¡®
- **ç¼ºç‚¹**ï¼šMongoDBå­˜å‚¨å ç”¨è¾ƒå¤§
- **é€‚ç”¨**ï¼šMongoDBå­˜å‚¨å……è¶³ã€éœ€è¦ç²¾å‡†æ¨è

#### ç­–ç•¥2ï¼šä»…å­˜å‚¨æ‘˜è¦
```json
{
  "item_id": "article_001",
  "metadata": {
    "title": "æ ‡é¢˜",
    "summary": "æ‘˜è¦ï¼ˆ300-500å­—ï¼‰",        // ä»…å­˜å‚¨æ‘˜è¦
    "content_url": "https://..."          // åŸæ–‡é“¾æ¥
  }
}
```
- **ä¼˜ç‚¹**ï¼šå­˜å‚¨å ç”¨å°ã€ä¼ è¾“å¿«
- **ç¼ºç‚¹**ï¼šå‘é‡ç”Ÿæˆä¾èµ–æ‘˜è¦è´¨é‡
- **é€‚ç”¨**ï¼šå­˜å‚¨å—é™ã€åŸæ–‡å­˜å‚¨åœ¨å…¶ä»–ç³»ç»Ÿ

#### ç­–ç•¥3ï¼šåˆ†æ®µå­˜å‚¨ï¼ˆé«˜çº§ï¼‰
```json
{
  "item_id": "article_001",
  "metadata": {
    "title": "æ ‡é¢˜",
    "summary": "æ‘˜è¦",
    "content_chunks": [              // åˆ†æ®µå­˜å‚¨
      "ç¬¬ä¸€æ®µå†…å®¹...",
      "ç¬¬äºŒæ®µå†…å®¹...",
      "ç¬¬ä¸‰æ®µå†…å®¹..."
    ]
  }
}
```
- **ä¼˜ç‚¹**ï¼šå…¼é¡¾å­˜å‚¨å’Œè¯­ä¹‰
- **ç¼ºç‚¹**ï¼šéœ€è¦è‡ªå®šä¹‰åˆ†æ®µé€»è¾‘
- **é€‚ç”¨**ï¼šé•¿æ–‡æœ¬æ¨èï¼ˆå¦‚ä¹¦ç±ã€è®ºæ–‡ï¼‰

**æ¨èåšæ³•**ï¼š
- æ–°é—»/æ–‡ç« ï¼šå­˜å‚¨`summary`ï¼ˆ300-500å­—ï¼‰+ `content_url`
- å•†å“ï¼šå­˜å‚¨`description`ï¼ˆ500å­—ä»¥å†…ï¼‰
- è§†é¢‘/éŸ³ä¹ï¼šå­˜å‚¨`title` + `tags`ï¼ˆæ— éœ€æ­£æ–‡ï¼‰

### Q7: ç‰©å“æ•°æ®æ›´æ–°åï¼Œå¤šä¹…èƒ½åœ¨æ¨èç»“æœä¸­çœ‹åˆ°ï¼Ÿ

**A**: æ•°æ®æµæ—¶æ•ˆæ€§å¦‚ä¸‹ï¼š

| ç¯èŠ‚ | æ—¶æ•ˆ | è¯´æ˜ |
|-----|------|------|
| **ç‰©å“å†™å…¥MongoDB** | ç§’çº§ï¼ˆ< 3sï¼‰ | APIæ¨é€ç«‹å³å†™å…¥ |
| **å‘é‡ç”Ÿæˆ** | åˆ†é’Ÿçº§ï¼ˆ1-5åˆ†é’Ÿï¼‰ | å¼‚æ­¥é˜Ÿåˆ—å¤„ç† |
| **ç´¢å¼•æ›´æ–°ï¼ˆMilvusï¼‰** | åˆ†é’Ÿçº§ï¼ˆ1-3åˆ†é’Ÿï¼‰ | è‡ªåŠ¨å¢é‡æ›´æ–° |
| **æ¨èç»“æœå¯è§** | **3-8åˆ†é’Ÿ** | æ‰€æœ‰ç¯èŠ‚å®Œæˆå |
| **çƒ­åº¦ç´¢å¼•æ›´æ–°** | å°æ—¶çº§ï¼ˆ1å°æ—¶ï¼‰ | å®šæ—¶ä»»åŠ¡è®¡ç®— |

**åŠ é€Ÿæ–¹å¼**ï¼š
1. **è·³è¿‡å‘é‡ç”Ÿæˆ**ï¼ˆä¸´æ—¶ï¼‰ï¼š
   ```python
   # å…ˆæ’å…¥ç‰©å“ï¼Œç¨åè¡¥å……å‘é‡
   await item_service.create_item(data, generate_embedding=False)
   ```

2. **ä½¿ç”¨é¢„è®¡ç®—å‘é‡**ï¼š
   ```json
   {
     "item_id": "video_001",
     "metadata": {...},
     "embedding": [0.1, 0.2, ...]  // å®¢æˆ·ç«¯é¢„è®¡ç®—å‘é‡
   }
   ```

3. **ä½¿ç”¨çƒ­é—¨å¬å›**ï¼šæ–°ç‰©å“é€šè¿‡çƒ­é—¨å¬å›è·¯å¾„ç«‹å³å¯è§

### Q8: å¦‚ä½•æ‰¹é‡åˆ é™¤/ä¸‹æ¶ç‰©å“ï¼Ÿ

**A**: ä¸¤ç§åˆ é™¤æ–¹å¼ï¼š

#### æ–¹å¼1ï¼šè½¯åˆ é™¤ï¼ˆæ¨èï¼‰
```bash
# å•ä¸ªåˆ é™¤
curl -X DELETE \
  -H "X-Tenant-Id: tenant_001" \
  "http://recommender-api:8080/api/v1/items/video_001?scenario_id=vlog_main_feed"

# æ‰¹é‡åˆ é™¤ï¼ˆé€šè¿‡è„šæœ¬ï¼‰
for item_id in item_id_list:
    requests.delete(f"http://recommender-api:8080/api/v1/items/{item_id}")
```
- ç‰©å“çŠ¶æ€å˜ä¸º`deleted`
- ä¸å‡ºç°åœ¨æ¨èç»“æœä¸­
- å†å²è¡Œä¸ºæ•°æ®ä¿ç•™ï¼ˆç”¨äºåˆ†æï¼‰

#### æ–¹å¼2ï¼šç¡¬åˆ é™¤ï¼ˆè°¨æ…ï¼‰
```bash
curl -X DELETE \
  -H "X-Tenant-Id: tenant_001" \
  "http://recommender-api:8080/api/v1/items/video_001?scenario_id=vlog_main_feed&hard_delete=true"
```
- å½»åº•åˆ é™¤ç‰©å“æ•°æ®
- å‘é‡ç´¢å¼•åŒæ­¥åˆ é™¤
- **ä¸å¯æ¢å¤**

**æ‰¹é‡åˆ é™¤æœ€ä½³å®è·µ**ï¼š
```python
# Pythonæ‰¹é‡è½¯åˆ é™¤è„šæœ¬
import asyncio
import aiohttp

async def batch_delete_items(item_ids: list):
    """æ‰¹é‡åˆ é™¤ç‰©å“ï¼ˆå¹¶å‘ï¼‰"""
    async with aiohttp.ClientSession() as session:
        tasks = []
        for item_id in item_ids:
            url = f"http://recommender-api:8080/api/v1/items/{item_id}"
            tasks.append(
                session.delete(
                    url,
                    headers={"X-Tenant-Id": "tenant_001"},
                    params={"scenario_id": "vlog_main_feed"}
                )
            )
        
        results = await asyncio.gather(*tasks, return_exceptions=True)
        
        success = sum(1 for r in results if not isinstance(r, Exception))
        print(f"æˆåŠŸåˆ é™¤: {success}/{len(item_ids)}")

# ä½¿ç”¨
await batch_delete_items(["video_001", "video_002", ...])
```

### Q9: æ¨èç³»ç»Ÿæ˜¯å¦æ”¯æŒç‰©å“å±æ€§æ›´æ–°ï¼ˆå¦‚ä»·æ ¼ã€åº“å­˜ï¼‰ï¼Ÿ

**A**: æ”¯æŒï¼Œä½¿ç”¨`PUT`æ¥å£æ›´æ–°ï¼š

```bash
# æ›´æ–°å•†å“ä»·æ ¼
curl -X PUT \
  -H "X-Tenant-Id: tenant_001" \
  -H "Content-Type: application/json" \
  "http://recommender-api:8080/api/v1/items/product_001?scenario_id=ecommerce_main" \
  -d '{
    "metadata": {
      "price": 8999.00,
      "stock": 100
    }
  }'
```

**æ³¨æ„äº‹é¡¹**ï¼š
- ä»…æ›´æ–°`metadata`å­—æ®µï¼Œå…¶ä»–å­—æ®µä¸å˜
- ä¸ä¼šé‡æ–°ç”Ÿæˆå‘é‡ï¼ˆé™¤éæ˜¾å¼æŒ‡å®š`regenerate_embedding=true`ï¼‰
- é€‚ç”¨äºé«˜é¢‘æ›´æ–°å­—æ®µï¼ˆä»·æ ¼ã€åº“å­˜ã€ç»Ÿè®¡æ•°æ®ï¼‰

**é«˜é¢‘æ›´æ–°å»ºè®®**ï¼š
```python
# æ¯å°æ—¶åŒæ­¥ä¸€æ¬¡ä»·æ ¼/åº“å­˜
import schedule

def sync_prices():
    """ä»ä¸šåŠ¡ç³»ç»ŸåŒæ­¥ä»·æ ¼"""
    products = fetch_products_from_db()
    
    for product in products:
        requests.put(
            f"http://recommender-api:8080/api/v1/items/{product['id']}",
            json={
                "metadata": {
                    "price": product["price"],
                    "stock": product["stock"]
                }
            }
        )

schedule.every().hour.do(sync_prices)
```

### Q10: å‘é‡ç”Ÿæˆä½¿ç”¨å“ªä¸ªæ¨¡å‹ï¼Ÿå¯ä»¥è‡ªå®šä¹‰å—ï¼Ÿ

**A**: å½“å‰æ”¯æŒçš„å‘é‡æ¨¡å‹ï¼š

| æ¨¡å‹ | ç»´åº¦ | è¯­è¨€ | æ€§èƒ½ | é€‚ç”¨åœºæ™¯ |
|-----|------|------|------|---------|
| **OpenAI text-embedding-3-small** | 1536 | å¤šè¯­è¨€ | é«˜è´¨é‡ | ç”Ÿäº§ç¯å¢ƒï¼ˆæ¨èï¼‰â­ |
| **SentenceTransformerï¼ˆæœ¬åœ°ï¼‰** | 768 | å¤šè¯­è¨€ | ä¸­ç­‰ | æ— å¤–éƒ¨ä¾èµ– |
| **BGE-large-zh** | 1024 | ä¸­æ–‡ | é«˜è´¨é‡ | ä¸­æ–‡ä¼˜åŒ– |
| **M3E-base** | 768 | ä¸­æ–‡ | ä¸­ç­‰ | è½»é‡çº§ä¸­æ–‡ |

**è‡ªå®šä¹‰å‘é‡æ¨¡å‹**ï¼š
```python
# é…ç½®æ–‡ä»¶
EMBEDDING_MODEL=openai  # å¯é€‰ï¼šopenai/sentence_transformer/bge/m3e/custom

# ä½¿ç”¨è‡ªå®šä¹‰æ¨¡å‹
class CustomEmbeddingModel:
    def encode(self, texts: List[str]) -> np.ndarray:
        # å®ç°æ‚¨çš„å‘é‡ç”Ÿæˆé€»è¾‘
        return your_model.encode(texts)
```

**æœ€ä½³å®è·µ**ï¼š
- ç”Ÿäº§ç¯å¢ƒï¼šä½¿ç”¨OpenAIï¼ˆè´¨é‡æœ€é«˜ï¼‰
- ä¸­æ–‡åœºæ™¯ï¼šä½¿ç”¨BGEï¼ˆä¸­æ–‡ä¼˜åŒ–ï¼‰
- ç¦»çº¿ç¯å¢ƒï¼šä½¿ç”¨SentenceTransformerï¼ˆæ— éœ€è”ç½‘ï¼‰

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### ç›¸å…³æ–‡æ¡£
- [ç³»ç»Ÿè®¾è®¡æ–‡æ¡£](./ç³»ç»Ÿè®¾è®¡.md) - ç³»ç»Ÿæ•´ä½“æ¶æ„
- [æ•°æ®åˆ†ææ¶æ„æ–¹æ¡ˆ](./æ•°æ®åˆ†ææ¶æ„æ–¹æ¡ˆ.md) - æ•°æ®æµä¸åˆ†æ
- [è¡Œä¸ºæ•°æ®åŸ‹ç‚¹æŒ‡å—](./è¡Œä¸ºæ•°æ®åŸ‹ç‚¹æŒ‡å—.md) - è¡Œä¸ºæ•°æ®é‡‡é›†
- [å¼€å‘æŒ‡å—](./å¼€å‘æŒ‡å—.md) - å¼€å‘ç¯å¢ƒé…ç½®

### APIæ–‡æ¡£
- Swaggeræ–‡æ¡£ï¼šhttp://recommender-api:8080/api/v1/docs
- ReDocæ–‡æ¡£ï¼šhttp://recommender-api:8080/api/v1/redoc

### é—®é¢˜åé¦ˆ
- GitHub Issues: [lemo_recommender/issues](https://github.com/AndrewLiuZhangZong/lemo_recommender/issues)
- æŠ€æœ¯æ”¯æŒé‚®ç®±: support@example.com
- æŠ€æœ¯æ”¯æŒå¾®ä¿¡ç¾¤ï¼šè”ç³»ç®¡ç†å‘˜åŠ å…¥

### å¿«é€Ÿé“¾æ¥
- [ç‰©å“æ‰¹é‡å¯¼å…¥æ¥å£](http://recommender-api:8080/api/v1/docs#/Items/batch_create_items)
- [ç‰©å“æŸ¥è¯¢æ¥å£](http://recommender-api:8080/api/v1/docs#/Items/list_items)
- [åœºæ™¯ç®¡ç†æ¥å£](http://recommender-api:8080/api/v1/docs#/Scenarios)

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v2.0.0 (2024-10-30)
- âœ¨ æ–°å¢ï¼šä¸åŒåœºæ™¯çš„ç‰©å“æ•°æ®ç»“æ„è¯¦ç»†è¯´æ˜
- âœ¨ æ–°å¢ï¼šå®Œæ•´æ•°æ®æµå‘å›¾ï¼ˆä»æ¥å…¥åˆ°æ¨èï¼‰
- âœ¨ æ–°å¢ï¼šæ¨¡å‹è®­ç»ƒæµç¨‹è¯´æ˜
- ğŸ“ å®Œå–„ï¼šæœ€ä½³å®è·µï¼ˆåœºæ™¯åŒ–ã€æ€§èƒ½ä¼˜åŒ–ã€ç›‘æ§ï¼‰
- ğŸ“ å®Œå–„ï¼šå¸¸è§é—®é¢˜ï¼ˆ10ä¸ªé«˜é¢‘é—®é¢˜ï¼‰

### v1.0.0 (2024-10-20)
- ğŸ‰ åˆå§‹ç‰ˆæœ¬
- æ”¯æŒAPIæ¨é€å’ŒKafkaæ¶ˆè´¹ä¸¤ç§æ¥å…¥æ–¹å¼
- åŸºç¡€ç‰©å“æ•°æ®æ¨¡å‹

