# æœ¬åœ°å¼€å‘ç¯å¢ƒé…ç½®

## ä¾èµ–æœåŠ¡

### 1. MongoDB (ç”±æœ¬é¡¹ç›®å¯åŠ¨)
```bash
docker-compose up -d mongodb
```

**è¿æ¥ä¿¡æ¯**:
- URL: `mongodb://admin:password@localhost:27017`
- Database: `lemo_recommender`

### 2. Redis (ä½¿ç”¨æœ¬åœ°å·²æœ‰æœåŠ¡)

**å·²æœ‰é…ç½®**:
```yaml
redis:
  image: redis:7-alpine
  container_name: ai_lemo_redis
  ports:
    - "6379:6379"
  command: redis-server --appendonly yes --requirepass redis_password_2024
```

**è¿æ¥ä¿¡æ¯**:
- URL: `redis://:redis_password_2024@localhost:6379/0`
- å¯†ç : `redis_password_2024`

**éªŒè¯è¿æ¥**:
```bash
redis-cli -h localhost -p 6379 -a redis_password_2024 ping
```

### 3. Kafka (ä½¿ç”¨æœ¬åœ°å·²æœ‰æœåŠ¡)

**å·²æœ‰é…ç½®**:
```yaml
kafka:
  image: confluentinc/cp-kafka:7.5.0
  container_name: ad-mat-aegis-kafka
  ports:
    - "9092:9092"
    - "9093:9093"
  environment:
    KAFKA_NODE_ID: 1
    KAFKA_PROCESS_ROLES: 'broker,controller'
    # KRaftæ¨¡å¼ï¼Œæ— éœ€Zookeeper
```

**è¿æ¥ä¿¡æ¯**:
- Bootstrap Servers: `localhost:9092`

**éªŒè¯è¿æ¥**:
```bash
# åˆ—å‡ºæ‰€æœ‰topic
docker exec -it ad-mat-aegis-kafka kafka-topics --bootstrap-server localhost:9092 --list

# åˆ›å»ºæµ‹è¯•topic
docker exec -it ad-mat-aegis-kafka kafka-topics \
  --bootstrap-server localhost:9092 \
  --create \
  --topic user-behaviors \
  --partitions 3 \
  --replication-factor 1
```

## ç¯å¢ƒå˜é‡é…ç½®

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
cp .env.example .env
```

ç¡®è®¤é…ç½®æ­£ç¡®ï¼š

```env
# MongoDBï¼ˆæœ¬é¡¹ç›®å¯åŠ¨ï¼‰
MONGODB_URL=mongodb://admin:password@localhost:27017
MONGODB_DATABASE=lemo_recommender

# Redisï¼ˆä½¿ç”¨æœ¬åœ°å·²æœ‰ï¼‰
REDIS_URL=redis://:redis_password_2024@localhost:6379/0

# Kafkaï¼ˆä½¿ç”¨æœ¬åœ°å·²æœ‰ï¼‰
KAFKA_BOOTSTRAP_SERVERS=localhost:9092
```

## å¿«é€Ÿå¯åŠ¨

```bash
# 1. å®‰è£…ä¾èµ–
poetry install

# 2. å¯åŠ¨MongoDBï¼ˆRediså’ŒKafkaå·²åœ¨å…¶ä»–docker-composeä¸­è¿è¡Œï¼‰
docker-compose up -d mongodb

# 3. ç­‰å¾…MongoDBå°±ç»ª
sleep 5

# 4. å¯åŠ¨åº”ç”¨
poetry run python app/main.py
```

æˆ–è€…ä½¿ç”¨å¿«æ·è„šæœ¬ï¼š

```bash
./run.sh
```

## éªŒè¯æœåŠ¡

### æ£€æŸ¥æ‰€æœ‰æœåŠ¡çŠ¶æ€

```bash
# MongoDB
docker ps | grep lemo-mongodb

# Redis (æœ¬åœ°)
docker ps | grep ai_lemo_redis

# Kafka (æœ¬åœ°)
docker ps | grep ad-mat-aegis-kafka
```

### è®¿é—®API

å¯åŠ¨åè®¿é—®ï¼š
- APIæ–‡æ¡£: http://localhost:8000/api/v1/docs
- å¥åº·æ£€æŸ¥: http://localhost:8000/health

## ç›‘æ§æœåŠ¡

### Prometheus (å¯é€‰)
```bash
docker-compose up -d prometheus
```
è®¿é—®: http://localhost:9090

### Grafana (å¯é€‰)
```bash
docker-compose up -d grafana
```
è®¿é—®: http://localhost:3000 (admin/admin)

## åœæ­¢æœåŠ¡

```bash
# åªåœæ­¢æœ¬é¡¹ç›®çš„MongoDB
docker-compose down

# ä¿ç•™æœ¬åœ°çš„Rediså’ŒKafkaè¿è¡Œ
```

## å¸¸è§é—®é¢˜

### Q: Redisè¿æ¥å¤±è´¥ï¼Ÿ
**A**: æ£€æŸ¥å¯†ç æ˜¯å¦æ­£ç¡®ï¼Œç¡®è®¤ä½¿ç”¨ `redis_password_2024`

### Q: Kafkaè¿æ¥å¤±è´¥ï¼Ÿ
**A**: ç¡®è®¤Kafkaå®¹å™¨ `ad-mat-aegis-kafka` æ­£åœ¨è¿è¡Œï¼š
```bash
docker ps | grep kafka
docker logs ad-mat-aegis-kafka
```

### Q: MongoDBåˆå§‹åŒ–è„šæœ¬æœªæ‰§è¡Œï¼Ÿ
**A**: åˆ é™¤volumeé‡æ–°åˆ›å»ºï¼š
```bash
docker-compose down -v
docker-compose up -d mongodb
```

### 4. Milvus (ä½¿ç”¨æœ¬åœ°å·²æœ‰æœåŠ¡ï¼Œç¬¬äºŒé˜¶æ®µ)

**å·²æœ‰é…ç½®**:
```yaml
# Milvusä¾èµ–
etcd:
  container_name: ai_lemo_etcd
  ports: ["2379:2379"]

minio:
  container_name: ai_lemo_minio
  ports: ["9000:9000", "8001:9001"]

# Milvuså‘é‡æ•°æ®åº“
milvus:
  image: milvusdb/milvus:v2.4.15
  container_name: ai_lemo_milvus
  ports: ["19530:19530", "9091:9091"]

# Attuç®¡ç†ç•Œé¢
attu:
  container_name: ai_lemo_attu
  ports: ["8000:3000"]
```

**è¿æ¥ä¿¡æ¯**:
- Milvus gRPC: `localhost:19530`
- Milvus HTTP: `localhost:9091`
- MinIO API: `localhost:9000`
- MinIO Console: `localhost:8001`
- Attuç®¡ç†ç•Œé¢: `http://localhost:8000`

**éªŒè¯è¿æ¥**:
```python
from pymilvus import connections

# è¿æ¥Milvus
connections.connect(
    alias="default",
    host="localhost",
    port="19530"
)

# åˆ—å‡ºé›†åˆ
from pymilvus import utility
print(utility.list_collections())
```

**ç¬¬äºŒé˜¶æ®µå¯ç”¨**:
```env
# åœ¨.envä¸­è®¾ç½®
MILVUS_ENABLED=true
MILVUS_HOST=localhost
MILVUS_PORT=19530
```

---

## æœ¬åœ°æœåŠ¡æ€»è§ˆ

| æœåŠ¡ | å®¹å™¨åç§° | ç«¯å£ | æ¥æº | çŠ¶æ€ |
|------|---------|------|------|------|
| MongoDB | lemo-mongodb | 27017 | æœ¬é¡¹ç›® | âœ… |
| Redis | ai_lemo_redis | 6379 | æœ¬åœ°å·²æœ‰ | âœ… |
| Kafka | ad-mat-aegis-kafka | 9092/9093 | æœ¬åœ°å·²æœ‰ | âœ… |
| Etcd | ai_lemo_etcd | 2379 | æœ¬åœ°å·²æœ‰ | âœ… |
| MinIO | ai_lemo_minio | 9000/8001 | æœ¬åœ°å·²æœ‰ | âœ… |
| Milvus | ai_lemo_milvus | 19530/9091 | æœ¬åœ°å·²æœ‰ | âœ… |
| Attu | ai_lemo_attu | 8000 | æœ¬åœ°å·²æœ‰ | âœ… |
| Prometheus | lemo-prometheus | 9090 | æœ¬é¡¹ç›®(å¯é€‰) | ğŸ”§ |
| Grafana | lemo-grafana | 3000 | æœ¬é¡¹ç›®(å¯é€‰) | ğŸ”§ |

---

### Q: ç«¯å£å†²çªï¼Ÿ
**A**: 
- MongoDB: 27017 (æœ¬é¡¹ç›®)
- Redis: 6379 (æœ¬åœ°å·²æœ‰)
- Kafka: 9092 (æœ¬åœ°å·²æœ‰)
- Milvus: 19530/9091 (æœ¬åœ°å·²æœ‰)
- MinIO: 9000/8001 (æœ¬åœ°å·²æœ‰)
- Etcd: 2379 (æœ¬åœ°å·²æœ‰)

**æ³¨æ„**: Attuå ç”¨8000ç«¯å£ï¼Œæ¨èç³»ç»Ÿé»˜è®¤ä¹Ÿæ˜¯8000ï¼Œå»ºè®®ä¿®æ”¹æ¨èç³»ç»Ÿç«¯å£ä¸º8080ï¼š
```env
PORT=8080
```

ç¡®è®¤ç«¯å£æœªè¢«å…¶ä»–æœåŠ¡å ç”¨ã€‚

